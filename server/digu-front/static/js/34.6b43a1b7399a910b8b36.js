webpackJsonp([34],{"GR+l":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("mvHQ"),s=i.n(n),a=i("GeYD"),o=i("uSxg"),r=i("ufin"),l={name:"repository",data:function(){return{editHeadShow:!0,oldQuestionContent:"",textareaDisabled:!0,returnVisible:!1,visibleSound:!1,oldData:"",newData:"",editForm:{questionContent:""},questionContentOther:[],editRules:{name:[{required:!0,message:"请输入问题名称",trigger:"blur"}],region:[{required:!0,message:"请选择问题分类",trigger:"change"}],desc:[{required:!0,message:"输入回答",trigger:"blur"}]},editableTabsValue:"1",editableTabs:[{title:"回答1",name:"1",answerContent:"请输入回答",fileName:""}],tabIndex:1,tabActiveVal:0,videoVisible:!1,viewPlaying:!1,viewSource:"",pageFrom:"",videoVisibleTest:!1,videoTestData:{},videoTestIndex:[],viewSourceTest:"",fullScreenLoading:null}},created:function(){var e=this;a.a.$emit("contentTop",!1),this.queryKnowledgeItemDetail(),a.a.$on("closeSound",function(t){t&&(e.visibleSound=!1)}),a.a.$on("fileName",function(t){t&&(e.editableTabs[e.tabActiveVal].soundPath=t.soundPath,e.editableTabs[e.tabActiveVal].soundDuration=t.soundDuration,e.editableTabs[e.tabActiveVal].soundSize=t.soundSize,e.editableTabs[e.tabActiveVal].answerContent=t.soundContent,e.editableTabs[e.tabActiveVal].fileName=t.fileName)})},computed:{},components:{wVideo:o.a,wSound:r.default},methods:{handleUseAudio:function(){this.pageFrom="repositoryEdit",this.visibleSound=!0},search:function(){},handleTabsClick:function(e){this.tabActiveVal=1*e.index},handleVideo:function(e){var t=this;this.videoVisible=!0,this.$nextTick(function(){t.viewSource=e.soundPath})},handleCancelPlay:function(e,t){this.editableTabs[t].soundPath="",this.editableTabs[t].soundDuration="",this.editableTabs[t].soundSize=""},handleTabsEdit:function(e,t){if("add"===t){var i=this.editableTabs.length+1+"";this.editableTabs.push({title:"回答"+i,name:i,content:""}),this.editableTabsValue=i}if("remove"===t){if(this.editableTabs.length<2)return;var n=this.editableTabs,s=this.editableTabsValue;s===e&&n.forEach(function(t,i){if(t.name===e){var a=n[i+1]||n[i-1];a&&(s=a.name)}}),this.editableTabs=n.filter(function(t){return t.name!==e}),this.editableTabs=this.editableTabs.map(function(e,t){return{title:"回答"+(t+1),name:""+(t+1),answerContent:e.answerContent,soundPath:e.soundPath,soundDuration:e.soundDuration,soundSize:e.soundSize}}),this.editableTabsValue=this.editableTabs.length+""}},handleShowEdit:function(e){"edit"==e&&(this.oldQuestionContent=this.editForm.questionContent),"cancel"==e&&(this.editForm.questionContent=this.oldQuestionContent),this.editHeadShow=!this.editHeadShow},queryKnowledgeItemDetail:function(){var e=this,t={id:this.$route.params.id};$.get(this.$baseUrl+"knowledge/queryKnowledgeItemDetail.json",$.param(t)).then(function(t){if("0000"==t.resultMessageEnum){var i=void 0!==t.returnObject.questionContentOther&&""!==t.returnObject.questionContentOther?t.returnObject.questionContentOther:"[]",n=JSON.parse(i),s=JSON.parse(t.returnObject.answerContent);if(s.length&&(e.editableTabs=s.map(function(e,t){return{title:"回答"+(t+1),name:""+(t+1),answerContent:""+e.text,soundPath:e.soundPath,soundDuration:e.soundDuration,soundSize:e.soundSize}})),e.editForm&&n.length){var a=[];n.forEach(function(e,t){a[t]={},a[t].name=e}),e.questionContentOther=a}e.editForm=t.returnObject}})},addQustion:function(){var e={isEdit:!0,show:!0,name:""};this.questionContentOther.length<1?this.questionContentOther.push(e):this.questionContentOther.splice(0,0,e)},textareaEdit:function(){this.textareaDisabled=!1},answerEdit:function(e){"edit"==e?(this.editForm.oldAnswerContent=this.editForm.answerContent,this.textareaDisabled=!1):"confirm"==e?this.textareaDisabled=!0:"cancel"==e&&(this.textareaDisabled=!0,this.editForm.answerContent=this.editForm.oldAnswerContent)},questionEdit:function(e,t){switch(e){case"edit":this.questionContentOther[t].show=!0,this.questionContentOther[t].isEdit=!0,this.questionContentOther[t].oldName=this.questionContentOther[t].name;break;case"del":this.questionContentOther.splice(t,1);break;case"confirm":this.questionContentOther[t].show=!1,this.questionContentOther[t].fixed=!1,this.questionContentOther[t].isEdit=!1;break;case"cancel":this.questionContentOther[t].oldName?(this.questionContentOther[t].show=!1,this.questionContentOther[t].isEdit=!1,this.questionContentOther[t].name=this.questionContentOther[t].oldName):this.questionContentOther.splice(t,1)}},modifyKnowledgeItem:function(){var e=this,t=!0;if(!this.editForm.questionContent)return this.$message.error("请添加主问题！"),!1;if(!this.questionContentOther.length)return this.$message.error("请添加相似问题！"),!1;if(!this.editForm.answerContent)return this.$message.error("请添加回答！"),!1;var i=[];this.questionContentOther.forEach(function(e){i.push(e.name)});var n=this.editableTabs.map(function(i){return i.answerContent?{text:i.answerContent,soundPath:i.soundPath,soundDuration:i.soundDuration,soundSize:i.soundSize}:(t=!1,e.$message.error("答案内容不能为空！"),!1)});if(t){var a={id:this.$route.params.id,questionContent:this.editForm.questionContent,questionContentOther:s()(i),answerContent:s()(n)};$.post(this.$baseUrl+"knowledge/modifyKnowledgeItem.json",s()(a)).then(function(t){"0000"==t.resultMessageEnum?(e.$message.success("保存成功！"),e.returnVisible&&(e.returnVisible=!1),e.goBack()):e.$message.error(t.errorInfoList[0].errorMessage)})}},uploadAnnexFileOfInfo:function(e,t){var i=this,n=new FormData;n.append("sourceType",103),n.append("file",$(".importFile")[t].files[0]),$(".importFile").eq(t).val(""),$.ajax({url:this.$baseUrl+"common/uploadAnnexFileOfInfo.json",type:"POST",cache:!1,data:n,dataType:"json",headers:{"Content-Type":"multipart/form-data"},processData:!1,contentType:!1,async:!1}).done(function(e){if("0000"==e.resultMessageEnum){var t=e.returnObject;i.editableTabs[i.tabActiveVal].soundPath=t.filePath,i.editableTabs[i.tabActiveVal].soundDuration=t.soundDuration,i.editableTabs[i.tabActiveVal].soundSize=t.fileSize}else i.$message.error("上传失败！")}).fail(function(e){})},changeExcelFile:function(){$("#importFile").val("")},goBack:function(){this.$router.go(-1)},handleCancel:function(){this.questionContentOther=[],this.queryKnowledgeItemDetail(),this.$router.push("/repository")},handleVideoTest:function(){var e=this;self=this,self.viewSourceTest="";var t=this.editableTabs,i=this.editableTabsValue,n="";if(t.forEach(function(e){e.name==i&&(n=e.answerContent)}),void 0!=n&&"currentContent"!=n&&""!=n){var s={audios:[],isAudit:0},a=[],o=n.split("["),r="<div>";if(o.length>1)o.forEach(function(t){if(""!=t){if(null==t.match("]$"))return void e.$message.error("试听变量格式有问题");var i=t.replace("]","");r+="<div>["+i+']<input type="text" id="'+i+'" value=""></div>',a.push(i);var n={text:i};s.audios.push(n)}});else if(1==o.length){r+="<div>"+n+"</div>";var l={text:n};s.audios.push(l)}r+="</div>",this.videoVisibleTest=!0,setTimeout(function(){document.getElementById("testVideoHtml").innerHTML=r},500,r),this.videoTestIndex=a,this.videoTestData=s}else self.$message.error("内容为空不能试听")},handleVideoTestListen:function(){var e=this;if(this.openFullScreenLoading("生成中"),self=this,this.videoTestIndex.length>0)for(var t in this.videoTestData.audios){var i=document.getElementById(this.videoTestData.audios[t].text).value;this.videoTestData.audios[t].text=i}$.post(this.$baseUrl+"knowledge/testListen.json",s()(this.videoTestData)).then(function(t){e.fullScreenLoading.close(),"0000"==t.resultMessageEnum?self.$nextTick(function(){self.viewSourceTest=t.returnObject.joinUrl}):self.$message.error(t.errorInfoList[0].errorMessage)})},openFullScreenLoading:function(e){this.fullScreenLoading=this.$loading({lock:!0,text:e+"...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})}},watch:{videoVisible:function(e){e||a.a.$emit("viewPlaying",!0)}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"table"},[i("div",{staticClass:"goto-header clearfix",attrs:{slot:"header"},slot:"header"},[i("a",{staticClass:"link",on:{click:e.goBack}},[i("i",{staticClass:"el-icon-arrow-left"}),e._v("返回问答对列表")])]),e._v(" "),i("div",{staticClass:"w-container"},[i("el-card",{staticClass:"box-card repository-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("编辑问答")])]),e._v(" "),i("div",{staticClass:"repository-edit-box"},[i("el-form",{ref:"editForm",staticClass:"demo-ruleForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"100px"}},[i("div",{staticClass:"form-head"},[e._v("\n\t\t\t\t\t\t主问题：\n\t\t\t\t\t\t"),e._v(" "),i("el-input",{attrs:{placeholder:"主问题"},model:{value:e.editForm.questionContent,callback:function(t){e.$set(e.editForm,"questionContent",t)},expression:"editForm.questionContent"}})],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"w__header"},[i("span",{staticClass:"left w_rell"},[e._v("相似问题"),i("i",{staticClass:"iconfont icon-ico_add",on:{click:e.addQustion}})]),e._v(" "),i("span",{staticClass:"right w_rell"},[e._v("操作")])]),e._v(" "),i("div",{staticClass:"w__body left"},e._l(e.questionContentOther,function(t,n){return i("div",{key:n,staticClass:"w__body_item",class:{row_striped:n%2==0,fixed:t.fixed}},[i("span",{staticClass:"w_rell"},[i("el-input",{attrs:{placeholder:"输入相似问题"},model:{value:t.name,callback:function(i){e.$set(t,"name",i)},expression:"item.name"}})],1),e._v(" "),i("span",{staticClass:"right w_rell"},[i("i",{staticClass:"iconfont icon-ico_delete",on:{click:function(t){return e.questionEdit("del",n)}}})])])}),0)]),e._v(" "),i("el-col",{attrs:{span:12}},[i("div",{staticClass:"repository-edit-tab"},[i("el-tabs",{attrs:{editable:""},on:{edit:e.handleTabsEdit,"tab-click":e.handleTabsClick},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,function(t,n){return i("el-tab-pane",{key:n,attrs:{label:t.title,name:t.name}},[i("div",{staticClass:"rep-edit-top"},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t您可以"),i("span",{staticClass:"link",on:{click:e.handleUseAudio}},[e._v("使用音频")]),e._v("（使用后将自动填充对应文本）或\n\t\t\t\t\t\t\t\t\t\t\t"),i("span",{staticClass:"link"},[e._v("上传音频"),i("input",{staticClass:"importFile",attrs:{type:"file",multiple:"multiple"},on:{change:function(i){return e.uploadAnnexFileOfInfo(t,n)}}})]),e._v(" "),i("div",{staticClass:"canel-box"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.soundPath,expression:"item.soundPath"}]},[i("i",{staticClass:"iconfont icon-icon_play",on:{click:function(i){return e.handleVideo(t)}}}),e._v(" "),i("span",[e._v(e._s(t.fileName))]),e._v(" "),i("span",{on:{click:function(i){return e.handleCancelPlay(t,n)}}},[e._v("取消")])]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.soundPath,expression:"!item.soundPath"}]},[i("i",{staticClass:"iconfont icon-icon_play",on:{click:e.handleVideoTest}})])])]),e._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.answerContent,expression:"item.answerContent"}],staticClass:"w_textarea",domProps:{value:t.answerContent},on:{input:function(i){i.target.composing||e.$set(t,"answerContent",i.target.value)}}})])}),1)],1)])],1)],1),e._v(" "),i("div",{staticClass:"repository-edit-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.modifyKnowledgeItem("editForm")}}},[e._v("保 存")])],1)],1)])],1),e._v(" "),i("el-dialog",{attrs:{title:"保存提示",visible:e.returnVisible,width:"400px"},on:{"update:visible":function(t){e.returnVisible=t}}},[i("div",[e._v("您尚未保存编辑！")]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.returnVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.modifyKnowledgeItem}},[e._v("保 存")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"音频",visible:e.videoVisible,width:"600px"},on:{"update:visible":function(t){e.videoVisible=t}}},[i("w-video",{attrs:{source:e.viewSource,playing:e.viewPlaying}})],1),e._v(" "),i("el-dialog",{attrs:{title:"知识库音频试听",visible:e.videoVisibleTest,width:"600px"},on:{"update:visible":function(t){e.videoVisibleTest=t}}},[i("div",{staticStyle:{width:"500px","margin-left":"20px"}},[i("span",[e._v("请填写变量参数试听文本")]),e._v(" "),i("div",{staticStyle:{padding:"5px","min-height":"200px",border:"1px solid silver"},attrs:{id:"testVideoHtml"}})]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.viewSourceTest,expression:"!viewSourceTest"}],staticClass:"canel-box"},[i("i",{staticClass:"iconfont icon-icon_play",on:{click:e.handleVideoTestListen}},[e._v("点击试听")])]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.viewSourceTest,expression:"viewSourceTest"}],staticClass:"canel-box"},[i("w-video",{attrs:{source:e.viewSourceTest,playing:e.viewPlaying}})],1)]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.visibleSound,expression:"visibleSound"}],staticClass:"sound-content"},[i("w-sound",{attrs:{from:e.pageFrom}})],1)],1)},staticRenderFns:[]};var u=i("VU/8")(l,d,!1,function(e){i("i8WS")},"data-v-10840eb2",null);t.default=u.exports},i8WS:function(e,t){}});