webpackJsonp([25],{EzsV:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("mvHQ"),a=n.n(i),s=n("DHmE"),o=n("nasK"),r=n("fMZB"),l={name:"repository",data:function(){return{readonly:!0,editHeadShow:!0,oldQuestionContent:"",textareaDisabled:!0,returnVisible:!1,visibleSound:!1,oldData:"",newData:"",editForm:{questionContent:""},questionContentOther:[],editRules:{name:[{required:!0,message:"请输入问题名称",trigger:"blur"}],region:[{required:!0,message:"请选择问题分类",trigger:"change"}],desc:[{required:!0,message:"输入回答",trigger:"blur"}]},editableTabsValue:"1",editableTabs:[{title:"回答1",name:"1",answerContent:"请输入回答"}],tabIndex:1,tabActiveVal:0,videoVisible:!1,viewPlaying:!1,viewSource:"",pageFrom:""}},created:function(){var e=this;s.a.$emit("contentTop",!1),this.queryKnowledgeItemDetail(),s.a.$on("closeSound",function(t){t&&(e.visibleSound=!1)}),s.a.$on("fileName",function(t){t&&(e.editableTabs[e.tabActiveVal].soundPath=t.soundPath,e.editableTabs[e.tabActiveVal].soundDuration=t.soundDuration,e.editableTabs[e.tabActiveVal].soundSize=t.soundSize,e.editableTabs[e.tabActiveVal].answerContent=t.soundContent)})},computed:{},components:{wVideo:o.a,wSound:r.a},methods:{handleUseAudio:function(){this.pageFrom="repositoryEdit",this.visibleSound=!0},search:function(){},handleTabsClick:function(e){this.tabActiveVal=1*e.index},handleVideo:function(e){var t=this;this.videoVisible=!0,this.$nextTick(function(){t.viewSource=e.soundPath})},handleCancelPlay:function(e,t){this.editableTabs[t].soundPath="",this.editableTabs[t].soundDuration="",this.editableTabs[t].soundSize=""},handleTabsEdit:function(e,t){if("add"===t){var n=++this.tabIndex+"";this.editableTabs.push({title:"回答"+n,name:n,content:""}),this.editableTabsValue=n}if("remove"===t){var i=this.editableTabs,a=this.editableTabsValue;if(i.length<2)return;a===e&&i.forEach(function(t,n){if(t.name===e){var s=i[n+1]||i[n-1];s&&(a=s.name)}}),this.editableTabsValue=a,this.editableTabs=i.filter(function(t){return t.name!==e})}},handleShowEdit:function(e){"edit"==e&&(this.oldQuestionContent=this.editForm.questionContent),"cancel"==e&&(this.editForm.questionContent=this.oldQuestionContent),this.editHeadShow=!this.editHeadShow},queryKnowledgeItemDetail:function(){var e=this,t={id:this.$route.params.id};$.get(this.$baseUrl+"services/knowledge/queryKnowledgeItemDetail.json",$.param(t)).then(function(t){if("0000"==t.resultMessageEnum){var n=JSON.parse(t.returnObject.questionContentOther),i=JSON.parse(t.returnObject.answerContent);if(i.length&&(e.editableTabs=i.map(function(e,t){return{title:"回答"+(t+1),name:""+(t+1),answerContent:""+e.text,soundPath:e.soundPath,soundDuration:e.soundDuration,soundSize:e.soundSize}})),e.editForm&&n.length){var a=[];n.forEach(function(e,t){a[t]={},a[t].name=e}),e.questionContentOther=a}e.editForm=t.returnObject}})},addQustion:function(){var e={isEdit:!0,show:!0,name:""};this.questionContentOther.length<1?this.questionContentOther.push(e):this.questionContentOther.splice(0,0,e)},textareaEdit:function(){this.textareaDisabled=!1},answerEdit:function(e){"edit"==e?(this.editForm.oldAnswerContent=this.editForm.answerContent,this.textareaDisabled=!1):"confirm"==e?this.textareaDisabled=!0:"cancel"==e&&(this.textareaDisabled=!0,this.editForm.answerContent=this.editForm.oldAnswerContent)},questionEdit:function(e,t){switch(e){case"edit":this.questionContentOther[t].show=!0,this.questionContentOther[t].isEdit=!0,this.questionContentOther[t].oldName=this.questionContentOther[t].name;break;case"del":this.questionContentOther.splice(t,1);break;case"confirm":this.questionContentOther[t].show=!1,this.questionContentOther[t].fixed=!1,this.questionContentOther[t].isEdit=!1;break;case"cancel":this.questionContentOther[t].oldName?(this.questionContentOther[t].show=!1,this.questionContentOther[t].isEdit=!1,this.questionContentOther[t].name=this.questionContentOther[t].oldName):this.questionContentOther.splice(t,1)}},modifyKnowledgeItem:function(){var e=this;if(!this.editForm.questionContent)return this.$message.error("请添加主问题！"),!1;if(!this.questionContentOther.length)return this.$message.error("请添加相似问题！"),!1;if(!this.editForm.answerContent)return this.$message.error("请添加回答！"),!1;var t=[];this.questionContentOther.forEach(function(e){t.push(e.name)});var n=this.editableTabs.map(function(e){return{text:e.answerContent,soundPath:e.soundPath,soundDuration:e.soundDuration,soundSize:e.soundSize}}),i={id:this.$route.params.id,questionContent:this.editForm.questionContent,questionContentOther:a()(t),answerContent:a()(n)};$.post(this.$baseUrl+"services/knowledge/modifyKnowledgeItem.json",a()(i)).then(function(t){"0000"==t.resultMessageEnum?(e.$message.success("保存成功！"),e.returnVisible&&(e.returnVisible=!1),e.goBack()):e.$message.error(t.errorInfoList[0].errorMessage)})},uploadAnnexFileOfInfo:function(e,t){var n=this,i=new FormData;i.append("sourceType",103),i.append("file",$(".importFile")[t].files[0]),$(".importFile").eq(t).val(""),$.ajax({url:this.$baseUrl+"services/common/uploadAnnexFileOfInfo.json",type:"POST",cache:!1,data:i,dataType:"json",headers:{"Content-Type":"multipart/form-data"},processData:!1,contentType:!1,async:!1}).done(function(e){if("0000"==e.resultMessageEnum){var t=e.returnObject;n.editableTabs[n.tabActiveVal].soundPath=t.filePath,n.editableTabs[n.tabActiveVal].soundDuration=t.soundDuration,n.editableTabs[n.tabActiveVal].soundSize=t.fileSize}else n.$message.error("上传失败！")}).fail(function(e){})},changeExcelFile:function(){$("#importFile").val("")},goBack:function(){this.$router.go(-1)},handleCancel:function(){this.questionContentOther=[],this.queryKnowledgeItemDetail(),this.$router.go(-1)}},watch:{videoVisible:function(e){e||s.a.$emit("viewPlaying",!0)}}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"table"},[n("div",{staticClass:"content-box-top"},[n("el-row",[n("el-col",{attrs:{span:20}},[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",[e._v("管理中心")]),e._v(" "),n("el-breadcrumb-item",[e._v("知识库管理")]),e._v(" "),n("el-breadcrumb-item",[e._v("用户知识库")]),e._v(" "),n("el-breadcrumb-item",[e._v("查看用户知识库")]),e._v(" "),n("el-breadcrumb-item",[e._v("问答对列表")]),e._v(" "),n("el-breadcrumb-item",[e._v("查看回答对")])],1)],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("i",{staticStyle:{"padding-right":"10px",float:"right","padding-bottom":"10px"}},[n("el-button",{on:{click:e.goBack}},[e._v("返回")])],1)])],1)],1),e._v(" "),n("div",{staticClass:"goto-header clearfix",attrs:{slot:"header"},slot:"header"},[e._m(0)]),e._v(" "),n("div",{staticClass:"w-container"},[n("el-card",{staticClass:"box-card repository-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("查看回答对")])]),e._v(" "),n("div",{staticClass:"repository-edit-box"},[n("el-form",{ref:"editForm",staticClass:"demo-ruleForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"100px"}},[n("div",{staticClass:"form-head"},[e._v("\n                        主问题：\n                        "),e._v(" "),n("el-input",{attrs:{placeholder:"主问题",readonly:e.readonly},model:{value:e.editForm.questionContent,callback:function(t){e.$set(e.editForm,"questionContent",t)},expression:"editForm.questionContent"}})],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("div",{staticClass:"w__header"},[n("span",{staticClass:"left w_rell"},[e._v("相似问题"),e.readonly?e._e():n("i",{staticClass:"iconfont icon-ico_add",on:{click:e.addQustion}})]),e._v(" "),n("span",{staticClass:"right w_rell"},[e._v("操作")])]),e._v(" "),n("div",{staticClass:"w__body left"},e._l(e.questionContentOther,function(t,i){return n("div",{key:i,staticClass:"w__body_item",class:{row_striped:i%2==0,fixed:t.fixed}},[n("span",{staticClass:"w_rell"},[n("el-input",{attrs:{placeholder:"输入相似问题",readonly:e.readonly},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"item.name"}})],1),e._v(" "),n("span",{staticClass:"right w_rell"},[e.readonly?e._e():n("i",{staticClass:"iconfont icon-ico_delete",on:{click:function(t){return e.questionEdit("del",i)}}})])])}),0)]),e._v(" "),n("el-col",{attrs:{span:12}},[n("div",{staticClass:"repository-edit-tab"},[n("el-tabs",{attrs:{editable:!e.readonly},on:{edit:e.handleTabsEdit,"tab-click":e.handleTabsClick},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,function(t,i){return n("el-tab-pane",{key:i,attrs:{label:t.title,name:t.name}},[n("div",{staticClass:"rep-edit-top"},[e.readonly?e._e():n("i",[e._v("您可以"),n("span",{staticClass:"link",on:{click:e.handleUseAudio}},[e._v("使用音频")]),e._v("（使用后将自动填充对应文本）或\n                                            "),n("span",{staticClass:"link"},[e._v("上传音频"),n("input",{staticClass:"importFile",attrs:{type:"file",multiple:"multiple"},on:{change:function(n){return e.uploadAnnexFileOfInfo(t,i)}}})])]),e._v(" "),n("div",{staticClass:"canel-box"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.soundPath,expression:"item.soundPath"}]},[n("i",{staticClass:"iconfont icon-icon_play",on:{click:function(n){return e.handleVideo(t)}}}),e._v(" "),e.readonly?e._e():n("span",{on:{click:function(n){return e.handleCancelPlay(t,i)}}},[e._v("取消")])])])]),e._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.answerContent,expression:"item.answerContent"}],staticClass:"w_textarea",attrs:{readonly:e.readonly},domProps:{value:t.answerContent},on:{input:function(n){n.target.composing||e.$set(t,"answerContent",n.target.value)}}})])}),1)],1)])],1)],1),e._v(" "),e.readonly?e._e():n("div",{staticClass:"repository-edit-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.modifyKnowledgeItem("editForm")}}},[e._v("保 存")])],1)],1)])],1),e._v(" "),n("el-dialog",{attrs:{title:"保存提示",visible:e.returnVisible,width:"400px"},on:{"update:visible":function(t){e.returnVisible=t}}},[n("div",[e._v("您尚未保存编辑！")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.returnVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.modifyKnowledgeItem}},[e._v("保 存")])],1)]),e._v(" "),n("el-dialog",{attrs:{title:"音频",visible:e.videoVisible,width:"600px"},on:{"update:visible":function(t){e.videoVisible=t}}},[n("w-video",{attrs:{source:e.viewSource,playing:e.viewPlaying}})],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.visibleSound,expression:"visibleSound"}],staticClass:"sound-content"},[n("w-sound",{attrs:{from:e.pageFrom}})],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("a",[t("i",{staticClass:"el-icon-arrow-left"}),this._v("返回问答对列表")])}]};var u=n("VU/8")(l,d,!1,function(e){n("IBZr")},"data-v-4a3fc75e",null);t.default=u.exports},IBZr:function(e,t){}});