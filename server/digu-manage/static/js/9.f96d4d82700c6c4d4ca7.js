webpackJsonp([9],{"23ul":function(e,t){},"9/t/":function(e,t){},ZN34:function(e,t){},aoLg:function(e,t,a){"use strict";var n=a("mvHQ"),i=a.n(n),s=a("DHmE"),o=a("nasK"),r=a("fMZB"),l={components:{wVideo:o.a,wSound:r.a},props:{initValues:Object,readonly:{type:Boolean,default:!1}},data:function(){return{formData:JSON.parse(i()(this.initValues)),editableTabsValue:"1",visibleSound:!1,videoVisible:!1,viewSource:"",viewPlaying:!1,videoVisibleTest:!1,viewSourceTest:"",vTabCount:this.initValues.editableTabs.length,pager:{current:1,size:10}}},computed:{questionContentOtherCount:function(){return(this.formData.questionContentOther||[]).length},currentQuestionContentOther:function(){var e=this.pager,t=e.current,a=e.size;return this.formData.questionContentOther.slice((t-1)*a,t*a)}},formRules:{name:[{required:!0,message:"请输入问题名称",trigger:"blur"}],region:[{required:!0,message:"请选择问题分类",trigger:"change"}],desc:[{required:!0,message:"输入回答",trigger:"blur"}]},methods:{addQustion:function(){this.goFirstPage(),this.formData.questionContentOther.unshift({isEdit:!0,show:!0,name:""})},handleQCODel:function(e){this.formData.questionContentOther.splice(e,1)},handleTabsEdit:function(e,t){if("add"===t){var a=""+ ++this.vTabCount;this.formData.editableTabs.push({title:"新问答",name:a,content:""}),this.editableTabsValue=a}if("remove"===t){var n=this.formData.editableTabs,i=this.editableTabsValue;if(n.length<2)return;i===e&&n.forEach(function(t,a){if(t.name===e){var s=n[a+1]||n[a-1];s&&(i=s.name)}}),this.editableTabsValue=i,this.formData.editableTabs=n.filter(function(t){return t.name!==e})}},handleUseAudio:function(){this.visibleSound=!0},handleVideo:function(e){var t=this;this.videoVisible=!0,this.$nextTick(function(){t.viewSource=e.soundPath})},handleCancelPlay:function(e){this.formData.editableTabs[e].soundPath=void 0,this.formData.editableTabs[e].soundDuration=void 0,this.formData.editableTabs[e].soundSize=void 0,this.formData.editableTabs[e].answerContent="",this.formData.editableTabs[e].fileName=void 0},uploadAnnexFileOfInfo:function(e,t){var a=this;this.openFullScreenLoading("上传中...");var n=new FormData;n.append("sourceType",103),n.append("file",$(".importFile")[t].files[0]),$(".importFile").eq(t).val(""),$.ajax({url:this.$baseUrl+"services/common/uploadAnnexFileOfInfo.json",type:"POST",cache:!1,data:n,dataType:"json",headers:{"Content-Type":"multipart/form-data"},processData:!1,contentType:!1,async:!1}).done(function(e){if(a.fullScreenLoading.close(),"0000"==e.resultMessageEnum){var t=e.returnObject;a.formData.editableTabs.forEach(function(e){e.name===a.editableTabsValue&&(a.$set(e,"soundPath",t.filePath),a.$set(e,"soundDuration",t.soundDuration),a.$set(e,"soundSize",t.fileSize),a.$set(e,"fileName",t.fileName))})}else a.$message.error("上传失败！")}).fail(function(e){a.fullScreenLoading.close()})},handleVideoTest:function(){var e=this;self=this,self.viewSourceTest="";var t=this.editableTabsValue,a="";if(this.formData.editableTabs.forEach(function(e){e.name==t&&(a=e.answerContent)}),void 0!=a&&"currentContent"!=a&&""!=a){var n={audios:[],isAudit:0},i=[],s=a.split("["),o="<div>";if(s.length>1)s.forEach(function(t){if(""!=t){if(null==t.match("]$"))return void e.$message.error("试听变量格式有问题");var a=t.replace("]","");o+="<div>["+a+']<input type="text" id="'+a+'" value=""></div>',i.push(a);var s={text:a};n.audios.push(s)}});else if(1==s.length){o+="<div>"+a+"</div>";var r={text:a};n.audios.push(r)}o+="</div>",this.videoVisibleTest=!0,setTimeout(function(){document.getElementById("testVideoHtml").innerHTML=o},500,o),this.videoTestIndex=i,this.videoTestData=n}else self.$message.error("内容为空不能试听")},handleVideoTestListen:function(){var e=this;if(this.openFullScreenLoading("生成中"),self=this,this.videoTestIndex.length>0)for(var t in this.videoTestData.audios){var a=document.getElementById(this.videoTestData.audios[t].text).value;this.videoTestData.audios[t].text=a}$.post(this.$baseUrl+"services/knowledge/testListen.json",i()(this.videoTestData)).then(function(t){e.fullScreenLoading.close(),"0000"==t.resultMessageEnum?self.$nextTick(function(){self.viewSourceTest=t.returnObject.joinUrl}):self.$message.error(t.errorInfoList[0].errorMessage)})},openFullScreenLoading:function(e){this.fullScreenLoading=this.$loading({lock:!0,text:e+"...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},goFirstPage:function(){var e=this;this.pager.current=1,this.$nextTick(function(){e.$refs.questionTable.scrollTop=0})},handleCurrentChange:function(e){this.pager.current=e},handleSizeChange:function(e){this.pager.size=e},handleCancel:function(){this.$emit("cancel")},handleSubmit:function(){var e=this;this.$refs.reposForm.validate(function(t){e.$emit("submit",e.formData)})}},created:function(){var e=this;s.a.$on("closeSound",function(t){t&&(e.visibleSound=!1)}),s.a.$on("fileName",function(t){t&&e.formData.editableTabs.forEach(function(a){a.name===e.editableTabsValue&&(a.soundPath=t.soundPath,a.soundDuration=t.soundDuration,a.soundSize=t.soundSize,a.answerContent=t.soundContent,a.fileName=t.fileName)})})},watch:{videoVisible:function(e){e||s.a.$emit("viewPlaying",!0)},initValues:function(e){this.formData=JSON.parse(i()(e))}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"reposForm",attrs:{model:e.formData,rules:e.$options.formRules,"label-width":"100px"}},[a("div",{staticClass:"form-head"},[a("label",[e._v("主问题：")]),e._v(" "),a("el-input",{attrs:{placeholder:"主问题",readonly:e.readonly},model:{value:e.formData.questionContent,callback:function(t){e.$set(e.formData,"questionContent",t)},expression:"formData.questionContent"}})],1),e._v(" "),a("el-row",{staticClass:"form-main"},[a("el-col",{staticClass:"left",attrs:{span:12}},[a("div",{staticClass:"w__header"},[a("span",{staticClass:"w_rell"},[e._v("\n            相似问题\n            "),e.readonly?e._e():a("i",{staticClass:"iconfont icon-ico_add",on:{click:e.addQustion}})]),e._v(" "),a("span",{staticClass:"right w_rell"},[e._v("操作")])]),e._v(" "),a("div",{ref:"questionTable",staticClass:"w__body"},e._l(e.currentQuestionContentOther,function(t,n){return a("div",{key:n,staticClass:"w__body_item",class:{row_striped:n%2==0,fixed:t.fixed}},[a("span",{staticClass:"w_rell"},[a("el-input",{attrs:{placeholder:"输入相似问题",readonly:e.readonly},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}})],1),e._v(" "),a("span",{staticClass:"right w_rell"},[e.readonly?e._e():a("i",{staticClass:"iconfont icon-ico_delete",on:{click:function(t){return e.handleQCODel(n)}}})])])}),0),e._v(" "),a("div",{staticClass:"pagination-wrapper"},[a("el-pagination",{attrs:{"current-page":e.pager.current,"page-sizes":[10,20,30,40],"page-size":e.pager.size,layout:"total, sizes, prev, pager, next, jumper",total:e.questionContentOtherCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"repository-edit-tab"},[a("el-tabs",{attrs:{editable:!e.readonly},on:{edit:e.handleTabsEdit},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.formData.editableTabs,function(t,n){return a("el-tab-pane",{key:n,attrs:{label:t.title,name:t.name}},[a("div",{staticClass:"answer-content"},[a("div",{staticClass:"rep-edit-top"},[e.readonly?e._e():a("i",[e._v("\n                    您可以\n                    "),a("span",{staticClass:"link",on:{click:e.handleUseAudio}},[e._v("使用音频")]),e._v("（使用后将自动填充对应文本）或\n                    "),a("span",{staticClass:"link"},[e._v("\n                      上传音频\n                      "),a("input",{staticClass:"importFile",attrs:{type:"file",multiple:"multiple"},on:{change:function(a){return e.uploadAnnexFileOfInfo(t,n)}}})])]),e._v(" "),a("div",{staticClass:"canel-box"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.soundPath,expression:"item.soundPath"}]},[a("i",{staticClass:"iconfont icon-icon_play",on:{click:function(a){return e.handleVideo(t)}}}),e._v(" "),t.fileName?a("span",[e._v(e._s(t.fileName))]):e._e(),e._v(" "),e.readonly?e._e():a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.handleCancelPlay(n)}}},[e._v("取消")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.soundPath,expression:"!item.soundPath"}]},[a("i",{staticClass:"iconfont icon-icon_play",on:{click:e.handleVideoTest}})])])]),e._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.answerContent,expression:"item.answerContent"}],staticClass:"w_textarea",attrs:{readonly:e.readonly},domProps:{value:t.answerContent},on:{input:function(a){a.target.composing||e.$set(t,"answerContent",a.target.value)}}})])])}),1)],1)])],1),e._v(" "),a("el-form-item",{attrs:{label:"关键词模版：",prop:"keyWordsTemplate"}},[a("el-select",{staticClass:"full-width",attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入正则表达式或关键词模版，按'enter'隔开","popper-class":"dropdown-hidden"},model:{value:e.formData.keyWordsTemplate,callback:function(t){e.$set(e.formData,"keyWordsTemplate",t)},expression:"formData.keyWordsTemplate"}},[a("div",{attrs:{slot:"empty"},slot:"empty"})])],1),e._v(" "),e.readonly?e._e():a("div",{staticClass:"form-footer"},[a("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保 存")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"音频",visible:e.videoVisible,width:"600px"},on:{"update:visible":function(t){e.videoVisible=t}}},[a("w-video",{attrs:{source:e.viewSource,playing:e.viewPlaying}})],1),e._v(" "),a("el-dialog",{attrs:{title:"知识库音频试听",visible:e.videoVisibleTest,width:"600px"},on:{"update:visible":function(t){e.videoVisibleTest=t}}},[a("div",{staticStyle:{width:"500px","margin-left":"20px"}},[a("span",[e._v("请填写变量参数试听文本")]),e._v(" "),a("div",{staticStyle:{padding:"5px","min-height":"200px",border:"1px solid silver"},attrs:{id:"testVideoHtml"}})]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.viewSourceTest,expression:"!viewSourceTest"}],staticClass:"canel-box"},[a("i",{staticClass:"iconfont icon-icon_play",on:{click:e.handleVideoTestListen}},[e._v("点击试听")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.viewSourceTest,expression:"viewSourceTest"}],staticClass:"canel-box"},[a("w-video",{attrs:{source:e.viewSourceTest,playing:e.viewPlaying}})],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.visibleSound,expression:"visibleSound"}],staticClass:"sound-content"},[a("w-sound",{attrs:{from:"repositoryEdit"}})],1)],1)},staticRenderFns:[]};var d=a("VU/8")(l,u,!1,function(e){a("23ul"),a("e6Wm")},"data-v-3e9288d9",null);t.a=d.exports},ccG8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("mvHQ"),i=a.n(n),s={components:{KnowledgeItemForm:a("aoLg").a},props:{groupId:String},initValues:{questionContent:"",questionContentOther:[{value:""}],editableTabs:[{title:"新问答",name:"1",answerContent:""}],keyWordsTemplate:[]},methods:{handleSubmit:function(e){var t=this,a=e.questionContent,n=e.questionContentOther,s=e.editableTabs,o=e.keyWordsTemplate,r={questionContent:a,groupId:this.groupId,questionContentOther:i()(n.map(function(e){return e.value}).filter(function(e){return!!e})),answerContent:i()(s.map(function(e){return{text:e.answerContent,soundPath:e.soundPath,soundDuration:e.soundDuration,soundSize:e.soundSize,fileName:e.fileName}})),keyWords:o.join("|")};$.post(this.$baseUrl+"services/knowledge/addKnowledgeItem.json",i()(r)).then(function(e){"0000"==e.resultMessageEnum?t.$emit("success"):t.$message.error(e.errorInfoList[0].errorMessage)})}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card",attrs:{header:"添加问答"}},[a("knowledge-item-form",{attrs:{initValues:e.$options.initValues},on:{cancel:function(t){return e.$emit("cancel")},submit:e.handleSubmit}})],1)],1)},staticRenderFns:[]};var r={components:{KnowledgeItemAddForm:a("VU/8")(s,o,!1,function(e){a("9/t/")},null,null).exports},computed:{repositoryUrl:function(){return"/repository/config/"+this.$route.params.id}},methods:{handleSuccess:function(){this.$message({message:"添加成功！",type:"success"}),this.$router.replace(this.repositoryUrl)},goGengal:function(){this.$router.push(this.repositoryUrl)}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"custom-header"},[a("div",[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[e._v("管理中心")]),e._v(" "),a("el-breadcrumb-item",[e._v("知识库管理")]),e._v(" "),a("el-breadcrumb-item",[e._v("通用知识库")]),e._v(" "),a("el-breadcrumb-item",[e._v("添加问答对")])],1)],1),e._v(" "),a("div",[a("el-button",{on:{click:e.goGengal}},[e._v("返回")])],1)]),e._v(" "),a("div",{staticClass:"content"},[a("knowledge-item-add-form",{attrs:{groupId:e.$route.params.id},on:{success:e.handleSuccess,cancel:e.goGengal}})],1)])},staticRenderFns:[]};var u=a("VU/8")(r,l,!1,function(e){a("ZN34")},"data-v-44a84da6",null);t.default=u.exports},e6Wm:function(e,t){}});