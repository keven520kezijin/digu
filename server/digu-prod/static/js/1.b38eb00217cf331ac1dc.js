webpackJsonp([1],{"0qUo":function(e,t){},"1nuA":function(e,t,n){"use strict";t.decode=t.parse=n("kMPS"),t.encode=t.stringify=n("xaZU")},HEAd:function(e,t){},UZ5h:function(e,t,n){"use strict";var s=n("xCWu"),a=n("qOJP");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){a.isString(e)&&(e=b(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var i=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},w=n("1nuA");function b(e,t,n){if(e&&a.isObject(e)&&e instanceof o)return e;var s=new o;return s.parse(e,t,n),s}o.prototype.parse=function(e,t,n){if(!a.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),r=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(r);if(b=b.trim(),!n&&1===e.split("#").length){var _=l.exec(b);if(_)return this.path=b,this.href=b,this.pathname=_[1],_[2]?(this.search=_[2],this.query=t?w.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var C=i.exec(b);if(C){var y=(C=C[0]).toLowerCase();this.protocol=y,b=b.substr(C.length)}if(n||C||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var x="//"===b.substr(0,2);!x||C&&v[C]||(b=b.substr(2),this.slashes=!0)}if(!v[C]&&(x||C&&!g[C])){for(var I,F,k=-1,K=0;K<d.length;K++){-1!==(A=b.indexOf(d[K]))&&(-1===k||A<k)&&(k=A)}-1!==(F=-1===k?b.lastIndexOf("@"):b.lastIndexOf("@",k))&&(I=b.slice(0,F),b=b.slice(F+1),this.auth=decodeURIComponent(I)),k=-1;for(K=0;K<h.length;K++){var A;-1!==(A=b.indexOf(h[K]))&&(-1===k||A<k)&&(k=A)}-1===k&&(k=b.length),this.host=b.slice(0,k),b=b.slice(k),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var D=this.hostname.split(/\./),$=(K=0,D.length);K<$;K++){var V=D[K];if(V&&!V.match(p)){for(var O="",q=0,S=V.length;q<S;q++)V.charCodeAt(q)>127?O+="x":O+=V[q];if(!O.match(p)){var T=D.slice(0,K),j=D.slice(K+1),M=V.match(m);M&&(T.push(M[1]),j.unshift(M[2])),j.length&&(b="/"+j.join(".")+b),this.hostname=T.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=s.toASCII(this.hostname));var N=this.port?":"+this.port:"",E=this.hostname||"";this.host=E+N,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!f[y])for(K=0,$=u.length;K<$;K++){var L=u[K];if(-1!==b.indexOf(L)){var Q=encodeURIComponent(L);Q===L&&(Q=escape(L)),b=b.split(L).join(Q)}}var U=b.indexOf("#");-1!==U&&(this.hash=b.substr(U),b=b.slice(0,U));var R=b.indexOf("?");if(-1!==R?(this.search=b.substr(R),this.query=b.substr(R+1),t&&(this.query=w.parse(this.query)),b=b.slice(0,R)):t&&(this.search="",this.query={}),b&&(this.pathname=b),g[y]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var z=this.search||"";this.path=N+z}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",s=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(i=w.stringify(this.query));var r=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),s&&"#"!==s.charAt(0)&&(s="#"+s),r&&"?"!==r.charAt(0)&&(r="?"+r),t+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(r=r.replace("#","%23"))+s},o.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(a.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,s=Object.keys(this),i=0;i<s.length;i++){var r=s[i];n[r]=this[r]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(n[u]=e[u])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!g[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||v[e.protocol])n.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),n.pathname=m.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var f=n.pathname||"",w=n.search||"";n.path=f+w}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),_=e.host||e.pathname&&"/"===e.pathname.charAt(0),C=_||b||n.host&&e.pathname,y=C,x=n.pathname&&n.pathname.split("/")||[],I=(m=e.pathname&&e.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(I&&(n.hostname="",n.port=null,n.host&&(""===x[0]?x[0]=n.host:x.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),C=C&&(""===m[0]||""===x[0])),_)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,x=m;else if(m.length)x||(x=[]),x.pop(),x=x.concat(m),n.search=e.search,n.query=e.query;else if(!a.isNullOrUndefined(e.search)){if(I)n.hostname=n.host=x.shift(),(P=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=P.shift(),n.host=n.hostname=P.shift());return n.search=e.search,n.query=e.query,a.isNull(n.pathname)&&a.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!x.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var F=x.slice(-1)[0],k=(n.host||e.host||x.length>1)&&("."===F||".."===F)||""===F,K=0,A=x.length;A>=0;A--)"."===(F=x[A])?x.splice(A,1):".."===F?(x.splice(A,1),K++):K&&(x.splice(A,1),K--);if(!C&&!y)for(;K--;K)x.unshift("..");!C||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),k&&"/"!==x.join("/").substr(-1)&&x.push("");var P,D=""===x[0]||x[0]&&"/"===x[0].charAt(0);I&&(n.hostname=n.host=D?"":x.length?x.shift():"",(P=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=P.shift(),n.host=n.hostname=P.shift()));return(C=C||n.host&&x.length)&&!D&&x.unshift(""),x.length?n.pathname=x.join("/"):(n.pathname=null,n.path=null),a.isNull(n.pathname)&&a.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},Y8JZ:function(e,t){},eArv:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("bOdI"),a=n.n(s),o=n("//Fk"),i=n.n(o),r=n("Dd8w"),l=n.n(r),c=n("mvHQ"),u=n.n(c),h=n("Xxa5"),d=n.n(h),p=n("exGp"),m=n.n(p),f=n("GeYD"),v=n("uSxg"),g=n("ufin"),w=n("mtWM"),b=n.n(w),_=n("CVRa"),C=(n("UZ5h"),{name:"BatchFiles",data:function(){return{fileList:[],extraData:null,correctArry:[],atchKnow:{excelPathTip:"",errorMessage:"",excelPath:"",filePath:"",filePathNew:"",excelPathTipNew:"",excelPathNew:""}}},computed:{groupId:function(){if(this.$route.path){var e=this.$route.path.split("/");return e[e.length-2]}return""}},methods:{close:function(){this.$emit("closeDrawer")},uploadFile:function(){var e=this;return m()(d.a.mark(function t(){var n,s;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((n={id:e.groupId,sourceType:102,excelTemplateType:2,filePath:e.atchKnow.excelPath}).filePath){t.next=4;break}return e.$message.error("必须上传文件"),t.abrupt("return");case 4:return t.next=6,b.a.post(e.$baseUrl+"knowledge/saveBatchKnowledgeItem.json",n);case 6:if(s=t.sent,s.data.resultMessageEnum===_.b){t.next=11;break}return e.$message.error("保存失败"),t.abrupt("return");case 11:e.$emit("uploadSuccess");case 12:case"end":return t.stop()}},t,e)}))()},downloadTemplate:function(){window.location.href=baseHost+"/download-static-file/knowledgeItemTemplate.xlsx"},uploadAnnexFile:function(e){var t=this,n=new FormData;n.append("sourceType",102),n.append("file",$("#"+e)[0].files[0]),$.ajax({url:this.$baseUrl+"common/uploadAnnexFile.json",type:"POST",cache:!1,data:n,dataType:"json",headers:{"Content-Type":"multipart/form-data"},processData:!1,contentType:!1,async:!1}).done(function(e){"0000"===e.resultMessageEnum?(t.upload_img_index>-1?(t.correctArry[t.upload_img_index].excelPathTip=t.correctArry[self.upload_img_index].filePath,t.correctArry[t.upload_img_index].excelPath=e.returnObject):(t.atchKnow.excelPathTip=t.atchKnow.filePath,t.atchKnow.excelPath=e.returnObject),t.checkAnnexFile()):t.$message.error("上传失败！")}).fail(function(e){})},checkAnnexFile:function(){var e=this,t={excelTemplateType:2};this.upload_img_index>-1?t.filePath=this.correctArry[this.upload_img_index].excelPath:t.filePath=this.atchKnow.excelPath,$.post(this.$baseUrl+"common/checkAnnexFile.json",u()(t)).then(function(t){if("0000"===t.resultMessageEnum){var n={};if(t.returnObject.correctFlag)n={nextUpload:!1,correctFilePath:t.returnObject.correctFilePath};else{var s=t.returnObject.rowNumber-t.returnObject.exceptionRowNumber+"条上传成功，剩余"+t.returnObject.exceptionRowNumber+"条上传失败！";e.correctArry.length>0?e.correctArry[e.upload_img_index].errorMessage=s:e.atchKnow.errorMessage=s;var a=(~~(1e5*Math.random())).toString();n={nextUpload:!0,correctFilePath:t.returnObject.correctFilePath,errorFilePath:e.$baseUrl+"file/downloadFile.html?filePath="+t.returnObject.errorFilePath,id:"file_"+a}}e.correctArry.push(n),e.upload_img_index++}else e.$message.error(t.errorInfoList[0].errorMessage)})}}}),y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"block"},[n("div",{staticClass:"batch-group"},[e._m(0),e._v(" "),n("div",{staticClass:"content-group"},[n("div",{staticClass:"column"}),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"content-item"},[e._v("请下载用于填写知识库问答的Excel模版文件")]),e._v(" "),n("div",{staticClass:"content-item"},[n("el-button",{staticClass:"download-button",attrs:{type:"primary",plain:""},on:{click:e.downloadTemplate}},[e._v("下载模板")])],1)])])]),e._v(" "),n("div",{staticClass:"batch-group"},[e._m(1),e._v(" "),n("div",{staticClass:"content-group"},[n("div",{staticClass:"content"},[n("div",{staticClass:"content-item"},[e._v("请上传已填写完成的Excel文件（建议最多不超过1000行）")]),e._v(" "),n("el-form",{ref:"uploadForm"},[n("el-form-item",[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.atchKnow.errorMessage,expression:"!atchKnow.errorMessage"}],staticClass:"file-btn"},[n("el-input",{attrs:{multiple:"multiple",type:"file",id:"file"},on:{change:function(t){return e.uploadAnnexFile("file")}},model:{value:e.atchKnow.filePath,callback:function(t){e.$set(e.atchKnow,"filePath",t)},expression:"atchKnow.filePath"}}),e._v(" "),n("span",{staticClass:"upload-span"},[e._v("上传")])],1)],1)],1),e._v(" "),n("span",{staticClass:"blue"},[e._v(e._s(e.atchKnow.excelPathTip))]),e._v(" "),n("span",{staticClass:"red"},[e._v(e._s(e.atchKnow.errorMessage))])],1)])]),e._v(" "),n("div",{staticClass:"batch-footer"},[n("el-button",{staticClass:"batch-footer-button",on:{click:e.close}},[e._v("取消")]),e._v(" "),n("el-button",{staticClass:"batch-footer-button",attrs:{type:"primary"},on:{click:e.uploadFile}},[e._v("保存")])],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title"},[t("span",{staticClass:"circle"},[this._v("1")]),this._v(" "),t("p",{staticClass:"title-text"},[this._v("下载模版")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title"},[t("span",{staticClass:"circle"},[this._v("2")]),this._v(" "),t("p",{staticClass:"title-text"},[this._v("上传文件")])])}]};var x=n("VU/8")(C,y,!1,function(e){n("wRsr"),n("Y8JZ")},null,null).exports,I={data:function(){return{matchAllKnoledgeItemList:[],tableSoundData:[],matchButtonDisabled:!1,matchSoundList:[],soundMatchVisible:!1,videoVisible:!1,viewSource:"",viewPlaying:!1}},components:{wVideo:v.a},props:{visible:!1,groupId:""},watch:{soundMatchVisible:function(e){e&&this.matchSound(),this.$emit("update:visible",e)},visible:function(e){this.soundMatchVisible=e},videoVisible:function(e){e||f.a.$emit("viewPlaying",!0)}},methods:{matchSound:function(){var e=this;this.soundMatchVisible=!0;var t={groupId:this.groupId,searchType:2,currentPage:0,pageSize:5e3},n=[],s=[];$.post(this.$baseUrl+"knowledge/queryKnowledgeItemList.json",u()(t)).then(function(t){var a,o;"0000"==t.resultMessageEnum?function(){var i=t.returnObject.recordList;if(e.matchAllKnoledgeItemList=i,""!=i&&i.length>0){for(a in i){var r=void 0;try{r=JSON.parse(i[a].answerContent)}catch(e){r=item.answerContent}"[object Array]"==Object.prototype.toString.call(r)&&r.length&&r.forEach(function(e,t){(""!=e.text&&"undefined"!=e.text&&!e.hasOwnProperty("soundPath")||""==e.soundPath)&&(n.push(e.text),s.push({ansewrText:e.text,knoledgeItemId:i[a].id}))})}o=[],$.post(e.$baseUrl+"sound/querySoundConfigItemListBySoundContent.json",u()(n)).then(function(n){"0000"==n.resultMessageEnum?(n.returnObject.forEach(function(e,t){s.forEach(function(t,n){t.ansewrText==e.soundContent&&(e.ansewrText=t.ansewrText,e.knoledgeItemId=t.knoledgeItemId,o.push(e))})}),e.tableSoundData=o):e.$message.error(t.errorInfoList[0].errorMessage)})}}():e.$message.error(t.errorInfoList[0].errorMessage)})},handleMatchSelectionChange:function(e){var t=this,n=[],s=!1;e.forEach(function(e){n.indexOf(e.knoledgeItemId+e.ansewrText)<0?n.push(e.knoledgeItemId+e.ansewrText):s||(t.$message.error("注意,同一回答选择了多条音频,默认取最后一条"),s=!0)}),this.matchSoundList=e},handleVideo:function(e){var t=this;this.videoVisible=!0,this.$nextTick(function(){t.viewSource=e.soundPath})},matchSoundConfirm:function(){var e=this;this.matchButtonDisabled=!0;var t=[];this.matchSoundList.forEach(function(n){e.matchAllKnoledgeItemList.forEach(function(s,a){if(n.knoledgeItemId==s.id){var o=void 0;try{o=JSON.parse(s.answerContent)}catch(e){o=s.answerContent}"[object Array]"==Object.prototype.toString.call(o)&&o.length&&(o.forEach(function(e,t){e.text==n.ansewrText&&(e.soundPath=n.soundPath,e.soundDuration=n.soundDuration,e.soundSize=n.soundSize,o[t]=e)}),e.matchAllKnoledgeItemList[a].answerContent=u()(o),t.indexOf(s.id)<0&&t.push(s.id))}})});var n=0,s=0,a=t.length;for(var o in t)this.matchAllKnoledgeItemList.forEach(function(i,r){if(t[o]==i.id){var l={};l.id=i.id,l.answerContent=i.answerContent,$.post(e.$baseUrl+"knowledge/modifyKnowledgeItem.json",u()(l)).then(function(t){"0000"==t.resultMessageEnum?(n+=1,0==(a-=1)&&(e.$message.error("匹配成功"+n+"条"),e.soundMatchVisible=!1,e.matchButtonDisabled=!1,e.$emit("queryKnowledgeItemList"))):(s+=1,0==(a-=1)&&(e.$message.error("匹配失败"+s+"条"),e.soundMatchVisible=!1,e.matchButtonDisabled=!1,e.$emit("queryKnowledgeItemList")))})}})}}},F={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-dialog",{attrs:{title:"音频",visible:e.videoVisible,width:"600px"},on:{"update:visible":function(t){e.videoVisible=t}}},[n("w-video",{attrs:{source:e.viewSource,playing:e.viewPlaying}})],1),e._v(" "),n("el-dialog",{attrs:{title:"匹配音频",visible:e.soundMatchVisible},on:{"update:visible":function(t){e.soundMatchVisible=t}}},[n("span",{staticStyle:{color:"#409EFF"}},[n("i",{staticClass:"el-icon-search primary"})]),e._v("已检测到音库中有"),n("span",{staticStyle:{color:"#409EFF"}},[e._v(e._s(e.tableSoundData.length)+"条")]),e._v("音频可以匹配给相应回答"),n("br"),e._v(" "),n("span",{staticStyle:{"font-size":"smaller"}},[e._v("已选"),n("span",{staticStyle:{color:"#E6A23C"}},[e._v(e._s(e.matchSoundList.length)+"条")])]),e._v(" "),n("el-table",{ref:"multipleMatchTable",staticStyle:{width:"100%"},attrs:{data:e.tableSoundData},on:{"selection-change":e.handleMatchSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{label:"音频"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{directives:[{name:"show",rawName:"v-show",value:t.row.soundPath,expression:"scope.row.soundPath"}],staticClass:"w_icon_play w_icon_pause",on:{click:function(n){return e.handleVideo(t.row)}}}),e._v(" "),n("span",[e._v(e._s(t.row.soundContent))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"ansewrText",label:"回答"}})],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.soundMatchVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.matchButtonDisabled},on:{click:e.matchSoundConfirm}},[e._v("匹 配")])],1)],1)],1)},staticRenderFns:[]};var k=n("VU/8")(I,F,!1,function(e){n("runL")},"data-v-6281f223",null).exports,K={id:"",questionContent:"",questionContentOther:[{value:""}],editableTabs:[{title:"回答1",name:"1",answerContent:"",fileName:""}],keyWords:[]},A=a()({name:"KnowledgeConfig",data:function(){return{checkAll:!1,soundMatchVisible:!1,tableHeight:200,groupName:"",knowledgeData:[],sigleKnowledgeData:{id:"",questionContent:"",questionContentOther:[{value:""}],editableTabs:[{title:"回答1",name:"1",answerContent:"",fileName:"",soundPath:"",soundDuration:"",soundSize:""}],keyWords:[]},cur_page:1,queryKey:"",moveRepositoryMenu:[],multipleSelection:[],delItemsVisible:!1,creatFAQVisible:!1,activeName:"first",publishStatus:!0,creatFAQVForm:{questionContent:"",questionContentOther:[{name:"相似问题",value:""}],creatFAQOptions:[],answerContent:[{name:"回答",value:"",soundPath:"",soundDuration:"",soundSize:""}]},creatFAQVRules:{questionContent:[{required:!0,message:"请输入主问题",trigger:"blur"}]},isNewFile:!1,atchKnow:{excelPathTip:"",errorMessage:"",excelPath:"",filePath:"",filePathNew:"",excelPathTipNew:"",excelPathNew:""},upload_img_index:-1,correctArry:[],atchKnowRules:{filePath:[{required:!0,message:"请上传知识问答Excel数据！",trigger:"change"}]},moveTypeOptions:[],moveTypeProps:{value:"id",label:"name",children:"children"},moveItemsVisible:!1,moveItemLength:0,moveItemName:"",pagination:{show:!0,total:0,pageIndex:1,pageSize:20},videoVisible:!1,viewSource:"",viewPlaying:!1,knowledgeCurrentData:[],currentIndex:0,visibleSound:!1,pageFrom:"",showDrawer:!1,sigleKnowledgeDataRules:{questionContent:{required:!0,message:"请输入主问题",trigger:"blur"}},editableTabsValue:"name1",inputVisible:!1,inputValue:"",dialogVisible:!1,dialogMessage:"",dialogTitle:"提示",showBatchFiles:!1,sortMethod:[{label:"更新时间顺序排序",value:"timeAsc"},{label:"更新时间倒序排序",value:"timeDesc"},{label:"操作人排序",value:"operator"}],sortMethodResult:"",isAddForm:!1}},created:function(){var e=this;return m()(d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=document.documentElement.clientHeight,e.tableHeight=n-290,f.a.$emit("contentTop",!0),f.a.$on("closeSound",function(t){t&&(e.visibleSound=!1)}),f.a.$on("fileName",function(t){t&&(e.creatFAQVForm.answerContent[e.currentIndex].soundPath=t.soundPath,e.creatFAQVForm.answerContent[e.currentIndex].soundDuration=t.soundDuration,e.creatFAQVForm.answerContent[e.currentIndex].soundSize=t.soundSize,e.creatFAQVForm.answerContent[e.currentIndex].value=t.soundContent,e.creatFAQVForm.answerContent[e.currentIndex].fileName=t.fileName,e.creatFAQVForm.answerContent[e.currentIndex].answerContent=t.soundContent)}),f.a.$on("fileName",function(t){t&&(e.sigleKnowledgeData.editableTabs[e.currentIndex].soundPath=t.soundPath,e.sigleKnowledgeData.editableTabs[e.currentIndex].soundDuration=t.soundDuration,e.sigleKnowledgeData.editableTabs[e.currentIndex].soundSize=t.soundSize,e.sigleKnowledgeData.editableTabs[e.currentIndex].value=t.soundContent,e.sigleKnowledgeData.editableTabs[e.currentIndex].fileName=t.fileName,e.sigleKnowledgeData.editableTabs[e.currentIndex].answerContent=t.soundContent)}),e.groupId=e.$route.params.id,e.groupName=e.$route.params.groupName,e.setknowledge=e.$store.getters.getknowledge,e.$store.getters.getKnowledgeData&&(e.knowledgeCurrentData=e.$store.getters.getKnowledgeData),t.next=12,e.queryKnowledgeItemList();case 12:e.formatKnowledgeMoveData();case 13:case"end":return t.stop()}},t,e)}))()},components:{wVideo:v.a,wSound:g.default,BatchFiles:x,AudioMatchModal:k},computed:{},filters:{formatLabel:function(e){return"回答"+(e+1)},formatName:function(e){return"name"+(e+1)}},methods:{handleCheckAllChange:function(e){this.multipleSelection=e?this.knowledgeData.map(function(e){return e.id}):[]},uploadSuccess:function(){this.showBatchFiles=!1,this.$message.success("批量上传问答成功"),this.queryKnowledgeItemList()},sortAction:function(e){"timeAsc"===e?this.knowledgeData.sort(function(e,t){return e.editTime.replace(/-/g,"").replace(/:/g,"").replace(" ","")-t.editTime.replace(/-/g,"").replace(/:/g,"").replace(" ","")}):"timeDesc"===e&&this.knowledgeData.sort(function(e,t){return t.editTime.replace(/-/g,"").replace(/:/g,"").replace(" ","")-e.editTime.replace(/-/g,"").replace(/:/g,"").replace(" ","")})},closeEdit:function(){this.isAddForm=!1},handleDropdown:function(e){switch(e){case"upload":this.showBatchFiles=!0;break;case"delete":this.handleDelItems();break;case"export":this.handleExport()}},handleExport:function(){var e=this;0!==this.multipleSelection.length?$.post(this.$baseUrl+"knowledge/batchExportKnowledgeItemExcelFile.json",u()(this.multipleSelection)).then(function(t){"0000"==t.resultMessageEnum?(e.multipleSelection=[],window.location.href=e.$baseUrl+"file/downloadFile.html?filePath="+t.returnObject.filePath,e.$message.success("导出成功")):e.$message.error("导出失败")}):this.$message.info("请勾选知识库!")},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;if(e){if(this.sigleKnowledgeData.keyWords.includes(e))return this.dialogTitle="关键词冲突提示",this.dialogMessage="该关键词已存在",void(this.dialogVisible=!0);if(e.trim()===this.sigleKnowledgeData.questionContent)return this.dialogTitle="关键词提示",this.dialogMessage="该关键词与主问题冲突",void(this.dialogVisible=!0);""===this.sigleKnowledgeData.keyWords&&(this.sigleKnowledgeData.keyWords=[]),this.sigleKnowledgeData.keyWords.push(e)}this.inputVisible=!1,this.inputValue=""},handleCloseKeyword:function(e){this.sigleKnowledgeData.keyWords.splice(this.sigleKnowledgeData.keyWords.indexOf(e),1)},modifyKnowledgeItem:function(){var e=this,t=!0;if(!this.sigleKnowledgeData.questionContent)return this.$message.error("请添加主问题！"),!1;if(!this.sigleKnowledgeData.questionContentOther.length)return this.$message.error("请添加相似问题！"),!1;if(!this.sigleKnowledgeData.editableTabs.map(function(e){return e.answerContent}).join().trim())return this.$message.error("请添加回答！"),!1;var n=[];this.sigleKnowledgeData.questionContentOther.forEach(function(e){n.push(e.value)});var s=this.sigleKnowledgeData.editableTabs.map(function(n){return n.answerContent?{text:n.answerContent,soundPath:n.soundPath||"",soundDuration:n.soundDuration||"",soundSize:n.soundSize||""}:(t=!1,e.$message.error("答案内容不能为空！"),!1)});if(t){var a={questionContent:this.sigleKnowledgeData.questionContent,questionContentOther:u()(this.sigleKnowledgeData.questionContentOther.map(function(e){return e.value}).filter(function(e){return e})),answerContent:u()(s),keyWords:this.sigleKnowledgeData.keyWords?this.sigleKnowledgeData.keyWords.join("|"):""};if(this.isAddForm){var o=l()({},a,{groupId:this.groupId,groupName:this.groupName});return void this.addKnowledge(o)}var i=l()({},a,{id:this.sigleKnowledgeData.id});$.post(this.$baseUrl+"knowledge/modifyKnowledgeItem.json",u()(i)).then(function(t){"0000"==t.resultMessageEnum?(e.$message.success("保存成功！"),e.showDrawer=!1,e.queryKnowledgeItemList()):e.$message.error(t.errorInfoList[0].errorMessage)})}},addKnowledge:function(e){var t=this;$.post(this.$baseUrl+"knowledge/addKnowledgeItem.json",u()(e)).then(function(e){"0000"==e.resultMessageEnum?(t.$message.success("新增成功"),t.showDrawer=!1,t.queryKnowledgeItemList()):t.$message.error(e.errorInfoList[0].errorMessage)})},handleTabsEdit:function(e,t){if("add"===t){var n="name"+(this.sigleKnowledgeData.editableTabs.length+1);this.creatFAQVForm.answerContent.push({soundPath:"",soundDuration:"",soundSize:"",value:"",fileName:"",answerContent:""}),this.sigleKnowledgeData.editableTabs.push({title:"回答"+n,name:n,content:""}),this.currentIndex=this.sigleKnowledgeData.editableTabs.length-1,this.editableTabsValue=n}if("remove"===t){if(this.sigleKnowledgeData.editableTabs.length<2)return;var s=e.replace(/[^\d]/g,"")-1;this.sigleKnowledgeData.editableTabs.splice(s,1),this.creatFAQVForm.answerContent.splice(s,1),this.currentIndex=this.sigleKnowledgeData.editableTabs.length-1,this.editableTabsValue="name"+this.sigleKnowledgeData.editableTabs.length}},handleWords:function(){},addSimilerQuestion:function(){this.sigleKnowledgeData.questionContentOther[this.sigleKnowledgeData.questionContentOther.length-1].value&&this.sigleKnowledgeData.questionContentOther.push({value:""})},deleteSimilerQuestion:function(e){this.sigleKnowledgeData.questionContentOther.splice(e,1)},editSigleKnowledgeData:function(e){e?this.sigleKnowledgeData=JSON.parse(u()(l()({},this.sigleKnowledgeData,e,{editableTabs:e.answerContent.map(function(e,t){return{title:"回答"+t,name:t.toString(),answerContent:e.text,fileName:"",soundPath:e.soundPath,soundDuration:e.soundDuration,soundSize:e.soundSize}})}))):(this.sigleKnowledgeData=JSON.parse(u()(K)),this.isAddForm=!0),this.showDrawer=!0},handleUseAudio:function(e){this.currentIndex=e,this.pageFrom="knowledgeConfig",this.visibleSound=!0},handleCurrentChange:function(e){this.cur_page=e,this.queryKnowledgeItemList()},handleDelItems:function(e){e?(this.multipleSelection=[e],this.delItemsVisible=!0):this.multipleSelection.length?this.delItemsVisible=!0:this.$message.error("请选择要删除的问答!")},goBack1:function(){this.$router.go(-1)},search:function(){this.cur_page=1,this.pagination.total=0,this.queryKnowledgeItemList()},searchChange:function(e){e||this.queryKnowledgeItemList()},sortChange:function(e){var t=!0;t="ascending"==e.order,this.sortList=[{propertyName:e.prop,ascendingFlag:t}],this.queryKnowledgeItemList()},handleCommand:function(){},handleVideo:function(e){var t=this;this.videoVisible=!0,this.$nextTick(function(){t.viewSource=e.soundPath})},handleVideoAnswer:function(){var e=this;this.videoVisible=!0,this.$nextTick(function(){e.viewSource=e.creatFAQVForm.answerContent[e.currentIndex].soundPath})},handleSelectionChange:function(e){this.multipleSelection=e},handleDelete:function(e,t){this.delItemsVisible=!0,this.deleId=t.id},handleCreatFAQV:function(){this.creatFAQVisible=!0,this.creatFAQVForm.creatFAQOptions=this.repositoryMenu},handleMoveItemChange:function(e){var t=this,n=this.knowledgeCurrentData.find(function(t){return e==t.id});this.queryKnowledgeGroupListOfPage(n.id).then(function(e){if(e){var s=e.map(function(e,t){return{label:e.groupName,value:e.id}});t.knowledgeItemListData=e,t.moveTypeOptions.forEach(function(e,t){n.id==e.id&&(e.children=s)})}})},moveTypeChange:function(e){if(this.multipleSelection.length){var t=this.knowledgeItemListData.find(function(t){return e[1]==t.id});this.newGroupId=t.id,this.moveItemsVisible=!0,this.moveItemLength=this.multipleSelection.length,this.moveItemName=t&&t.groupName;this.knowledgeItemIdList=this.multipleSelection.map(function(e){return e.id})}else this.$message.error("请选择要移动的问答!")},tabAnswer:function(e,t){this.currentIndex=t},tabClick:function(e,t){var n=t.target,s=n.parentNode;this.currentIndex=Array.prototype.indexOf.call(s.childNodes,n)},handleCancelPlay:function(){this.sigleKnowledgeData.editableTabs[this.currentIndex].soundPath="",this.sigleKnowledgeData.editableTabs[this.currentIndex].soundDuration="",this.sigleKnowledgeData.editableTabs[this.currentIndex].soundSize="",this.sigleKnowledgeData.editableTabs[this.currentIndex].answerContent="",this.creatFAQVForm.answerContent[this.currentIndex].soundPath="",this.creatFAQVForm.answerContent[this.currentIndex].soundDuration="",this.creatFAQVForm.answerContent[this.currentIndex].soundSize="",this.creatFAQVForm.answerContent[this.currentIndex].answerContent=""},addQuestion:function(){var e={name:"",value:""};this.creatFAQVForm.questionContentOther.length<2?this.creatFAQVForm.questionContentOther.push(e):this.creatFAQVForm.questionContentOther.splice(1,0,e)},addAnswer:function(){var e={name:"回答",value:"",soundPath:"",soundDuration:"",soundSize:""};this.creatFAQVForm.answerContent.push(e),this.tabAnswer(e,this.currentIndex+1)},removeQuestion:function(e){var t=this.creatFAQVForm.questionContentOther.indexOf(e);-1!==t&&this.creatFAQVForm.questionContentOther.splice(t,1)},formatKnowledgeMoveData:function(){var e=this;this.knowledgeCurrentData.forEach(function(t,n){var s={children:[]};s.name=t.typeName,s.id=t.id,e.moveTypeOptions.push(s)})},handleAddItems:function(e){var t=this;"first"==this.activeName?this.$refs.creatFAQVForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;t.addKnowledgeItem()}):this.saveBatchKnowledgeItem("atchKnow")},handleEdit:function(e){this.$router.push("/repository/edit/"+e)},moveKnowledgeItem:function(){var e=this,t={newGroupId:this.newGroupId,knowledgeItemIdList:this.knowledgeItemIdList};$.post(this.$baseUrl+"knowledge/moveKnowledgeItem.json",u()(t)).then(function(t){"0000"==t.resultMessageEnum?(e.moveItemsVisible=!1,e.queryKnowledgeItemList()):e.$message.error(t.errorInfoList[0].errorMessage)})},downloadExcelTemplate:function(){window.location.href=this.$baseUrl+"common/downloadExcelTemplate.html?excelTemplateType=2"},addKnowledgeItem:function(){var e=this,t=!0,n=[];this.creatFAQVForm.questionContentOther.forEach(function(e){n.push(e.value)});var s=[];if(this.creatFAQVForm.answerContent.forEach(function(n){if(!n.value)return t=!1,e.$message.error("答案内容不能为空！"),!1;s.push({text:n.value,soundPath:n.soundPath,soundDuration:n.soundDuration,soundSize:n.soundSize})}),t){var a={questionContent:this.creatFAQVForm.questionContent,groupId:this.groupId,questionContentOther:u()(n),answerContent:u()(s)};$.post(this.$baseUrl+"knowledge/addKnowledgeItem.json",u()(a)).then(function(t){"0000"==t.resultMessageEnum?(e.creatFAQVisible=!1,e.queryKnowledgeItemList()):e.$message.error(t.errorInfoList[0].errorMessage)})}},tableRowClassName:function(e){var t=e.row;e.rowIndex;if(t.isEdit&&1*t.isEdit>0)return"row-not-edit"},publishKnowledgeGroup:function(e){var t=this;e.target.className.indexOf("is-disabled")>-1||$.post(this.$baseUrl+"knowledge/publishKnowledgeGroup.json?groupId="+this.groupId).then(function(e){"0000"==e.resultMessageEnum?(t.publishStatus=!1,t.$message.success("发布成功"),t.queryKnowledgeItemList()):t.$message.error(e.errorInfoList[0].errorMessage)})},queryKnowledgeGroupListOfPage:function(e){var t=this;return new i.a(function(n,s){var a={searchType:2,typeId:e};$.post(t.$baseUrl+"knowledge/queryKnowledgeGroupListOfPage.json",u()(a)).then(function(e){if("0000"==e.resultMessageEnum){var s=e.returnObject&&e.returnObject.recordList;s&&n(s)}else t.$message.error(e.errorInfoList[0].errorMessage);n()})})},queryKnowledgeItemList:function(){var e=this;return m()(d.a.mark(function t(){var n,s,a,o;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={groupId:e.groupId,searchType:2,currentPage:e.cur_page-1,pageSize:e.pagination.pageSize},(s=e.queryKey)&&(n.queryKey=s),e.sortList&&(n.sortList=e.sortList),t.next=6,$.post(e.$baseUrl+"knowledge/queryKnowledgeItemList.json",u()(n));case 6:"0000"==(a=t.sent).resultMessageEnum?((o=a.returnObject&&a.returnObject.recordList)&&(o.forEach(function(e,t){e.answerContent=JSON.parse(e.answerContent||"[]"),e.questionContentOther=JSON.parse(e.questionContentOther||"[]").map(function(e){return{value:e}}),0===e.questionContentOther.length&&(e.questionContentOther=[{name:"相似问题",value:""}])}),o&&o.forEach(function(e){e.keyWords&&(e.keyWords=e.keyWords.split("|"))}),e.knowledgeData=o.filter(function(e){return!!e.questionContent})),e.pagination.total=a.returnObject.totalNumber):self.$message.error(a.errorInfoList[0].errorMessage);case 8:case"end":return t.stop()}},t,e)}))()},removeKnowledgeItemList:function(e){var t=this,n=[];this.deleId?n.push(this.deleId):this.multipleSelection.forEach(function(e){n.push(e)}),$.post(this.$baseUrl+"knowledge/removeKnowledgeItemList.json",u()(n)).then(function(e){"0000"==e.resultMessageEnum?(t.$message.success("删除成功！"),t.delItemsVisible=!1,t.multipleSelection=[],t.deleId="",t.queryKnowledgeItemList()):self.$message.error(e.errorInfoList[0].errorMessage)})},checkAnnexFile:function(){var e=this,t={excelTemplateType:2};this.upload_img_index>-1?t.filePath=this.correctArry[this.upload_img_index].excelPath:t.filePath=this.atchKnow.excelPath,$.post(this.$baseUrl+"common/checkAnnexFile.json",u()(t)).then(function(t){if("0000"==t.resultMessageEnum){var n={};if(t.returnObject.correctFlag)n={nextUpload:!1,correctFilePath:t.returnObject.correctFilePath};else{var s=t.returnObject.rowNumber-t.returnObject.exceptionRowNumber+"条上传成功，剩余"+t.returnObject.exceptionRowNumber+"条上传失败！";e.correctArry.length>0?e.correctArry[e.upload_img_index].errorMessage=s:e.atchKnow.errorMessage=s;var a=(~~(1e5*Math.random())).toString();n={nextUpload:!0,correctFilePath:t.returnObject.correctFilePath,errorFilePath:e.$baseUrl+"file/downloadFile.html?filePath="+t.returnObject.errorFilePath,id:"file_"+a}}e.correctArry.push(n),e.upload_img_index++}else e.$message.error(t.errorInfoList[0].errorMessage)})},uploadAnnexFile:function(e){var t=this,n=new FormData;n.append("sourceType",102),n.append("file",$("#"+e)[0].files[0]),$.ajax({url:this.$baseUrl+"common/uploadAnnexFile.json",type:"POST",cache:!1,data:n,dataType:"json",headers:{"Content-Type":"multipart/form-data"},processData:!1,contentType:!1,async:!1}).done(function(e){"0000"==e.resultMessageEnum?(t.upload_img_index>-1?(t.correctArry[t.upload_img_index].excelPathTip=t.correctArry[t.upload_img_index].filePath,t.correctArry[t.upload_img_index].excelPath=e.returnObject):(t.atchKnow.excelPathTip=t.atchKnow.filePath,t.atchKnow.excelPath=e.returnObject),t.checkAnnexFile()):t.$message.error("上传失败！")}).fail(function(e){})},saveBatchKnowledgeItem:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var n={id:t.groupId};if(t.correctArry.length){var s=[];t.correctArry.forEach(function(e){e.correctFilePath&&s.push(e.correctFilePath)}),n.correctFilePathList=s}else n.filePath=t.atchKnow.excelPath;$.post(t.$baseUrl+"knowledge/saveBatchKnowledgeItem.json",u()(n)).then(function(e){"0000"==e.resultMessageEnum?(t.creatFAQVisible=!1,t.queryKnowledgeItemList()):t.$message.error(e.errorInfoList[0].errorMessage)})})},uploadAnnexFileOfInfo:function(){var e=this,t=new FormData;t.append("sourceType",103),t.append("file",$(".importFile")[this.currentIndex].files[0]),$(".importFile").eq(this.currentIndex).val(""),$.ajax({url:this.$baseUrl+"common/uploadAnnexFileOfInfo.json",type:"POST",cache:!1,data:t,dataType:"json",headers:{"Content-Type":"multipart/form-data"},processData:!1,contentType:!1,async:!1}).done(function(t){if("0000"==t.resultMessageEnum){var n=t.returnObject;e.creatFAQVForm.answerContent[e.currentIndex].soundPath=n.filePath,e.creatFAQVForm.answerContent[e.currentIndex].soundDuration=n.soundDuration,e.creatFAQVForm.answerContent[e.currentIndex].soundSize=n.fileSize}else e.$message.error("上传失败！")}).fail(function(e){})}},watch:{creatFAQVisible:function(e){e||(this.$refs.creatFAQVForm.resetFields(),this.$refs.atchKnow.resetFields(),this.upload_img_index=-1,this.atchKnow.errorMessage="",this.atchKnow.excelPathTip="",this.atchKnow.excelPath="",this.atchKnow.filePath="",this.atchKnow.excelPathNew="",this.atchKnow.filePathNew="",this.atchKnow.excelPathTipNew="",this.isNewFile=!1,this.creatFAQVForm.questionContentOther=[{name:"相似问题",value:""}],this.creatFAQVForm.answerContent=[{name:"回答",value:"",soundPath:"",soundDuration:"",soundSize:""}],this.correctArry=[])}},destroyed:function(){}},"watch",{videoVisible:function(e){e||f.a.$emit("viewPlaying",!0)},queryKey:function(e){this.queryKey=e,this.queryKnowledgeItemList()}}),P={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"content-box-top"},[n("el-input",{staticClass:"handle-input mr10",attrs:{clearable:"",placeholder:"筛选关键词"},on:{change:e.searchChange},model:{value:e.queryKey,callback:function(t){e.queryKey=t},expression:"queryKey"}}),e._v(" "),n("el-button",{attrs:{type:"primary",icon:"search"},on:{click:e.search}},[e._v("搜索")])],1),e._v(" "),n("div",{staticClass:"clearfix knowledge-header",attrs:{slot:"header"},slot:"header"},[n("a",{staticClass:"link",on:{click:e.goBack1}},[n("i",{staticClass:"el-icon-arrow-left"}),e._v("返回知识库列表")]),e._v(" "),n("div",{staticClass:"right-menu-box"},[n("div",{staticClass:"right-menu-item"},[n("el-button",{attrs:{type:"primary",icon:"iconfont icon-icon_rep_search"},on:{click:e.publishKnowledgeGroup}},[e._v(" 发布")])],1),e._v(" "),n("div",{staticClass:"right-menu-item"},[n("el-button",{attrs:{type:"primary",icon:"iconfont icon-icon_rep_search"},on:{click:function(t){e.soundMatchVisible=!0}}},[e._v(" 匹配音频")])],1),e._v(" "),n("div",{staticClass:"right-menu-item"},[n("el-button",{attrs:{type:"primary",icon:"iconfont icon-icon_rep_search"},on:{click:function(t){return e.editSigleKnowledgeData(null)}}},[e._v(" 新增问答")])],1),e._v(" "),n("el-dropdown",{on:{command:e.handleDropdown}},[n("el-button",{attrs:{type:"primary"}},[n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"upload"}},[e._v("批量上传问答")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"export"}},[e._v("批量导出问答")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"delete"}},[e._v("批量删除问答")])],1)],1)],1)]),e._v(" "),n("div",{staticClass:"sort"},[n("el-checkbox",{on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),n("el-select",{attrs:{placeholder:"排序方式"},on:{change:e.sortAction},model:{value:e.sortMethodResult,callback:function(t){e.sortMethodResult=t},expression:"sortMethodResult"}},e._l(e.sortMethod,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("div",{staticClass:"config-card-list"},[n("el-checkbox-group",{model:{value:e.multipleSelection,callback:function(t){e.multipleSelection=t},expression:"multipleSelection"}},e._l(e.knowledgeData,function(t,s){return n("div",{key:s,staticClass:"config-card"},[n("div",{staticClass:"config-card-row"},[n("el-checkbox",{staticClass:"card-checkbox",attrs:{label:t.id}},[n("div",{staticClass:"question-title"},[e._v("主问题")])]),e._v(" "),n("div",{staticClass:"question-content"},[e._v(e._s(t.questionContent))]),e._v(" "),n("div",{staticClass:"right-edit-box"},[n("span",{staticClass:"w_icon_pen",on:{click:function(n){return e.editSigleKnowledgeData(t)}}}),e._v(" "),n("span",{staticClass:"w_icon_trash",on:{click:function(n){return e.handleDelItems(t.id)}}})])],1),e._v(" "),n("div",{staticClass:"config-card-row"},[n("div",{staticClass:"question-title"},[e._v("相似问题")]),e._v(" "),e._l(t.questionContentOther.filter(function(e){return e.value}),function(t,s){return n("div",{key:s,staticClass:"question-content question-similer"},[n("el-tag",[e._v(e._s(t.value))])],1)})],2),e._v(" "),n("div",{staticClass:"config-card-row"},[n("div",{staticClass:"question-title",staticStyle:{"padding-top":"10px"}},[e._v("回答内容")]),e._v(" "),n("div",{staticClass:"question-content"},[n("el-tabs",{attrs:{value:"name1"}},e._l(t.answerContent,function(t,s){return n("el-tab-pane",{key:s,attrs:{label:e._f("formatLabel")(s),name:e._f("formatName")(s)}},[n("div",{staticClass:"answer-content"},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.soundPath,expression:"content.soundPath"}],staticClass:"iconfont icon-icon_play",on:{click:function(n){return e.handleVideo(t)}}}),e._v(" "),n("div",{staticClass:"answer-content-text"},[e._v(e._s(t.text))])])])}),1)],1)]),e._v(" "),n("div",{staticClass:"config-card-row"},[n("div",{staticClass:"question-title"},[e._v("关键词")]),e._v(" "),e._l(t.keyWords,function(t){return n("div",{key:t,staticClass:"question-keywords"},[n("el-tag",{attrs:{type:"info"}},[e._v(e._s(t))])],1)})],2),e._v(" "),n("div",{staticClass:"config-card-footer"},[n("span",{staticClass:"primary-tag"},[e._v(e._s(t.publishStatus?"已发布":"未发布"))]),e._v(" "),n("span",{staticClass:"primary-tag"},[e._v("更新时间"+e._s(t.editTime))]),e._v(" "),n("span",{staticClass:"primary-tag"},[e._v("操作人: "+e._s(t.editor))])])])}),0)],1),e._v(" "),n("div",{staticClass:"pagination"},[n("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next,jumper",total:e.pagination.total,"page-size":e.pagination.pageSize},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),n("el-dialog",{attrs:{title:"删除问答",visible:e.delItemsVisible,width:"400px"},on:{"update:visible":function(t){e.delItemsVisible=t}}},[n("div",[e._v("您确定要删除已选择的知识库吗？如果知识库正在使用中，删除后将不能在已关联的话术中正常使用。")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.delItemsVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.removeKnowledgeItemList}},[e._v("确 定")])],1)]),e._v(" "),n("el-dialog",{attrs:{title:"移动问答",visible:e.moveItemsVisible,width:"400px"},on:{"update:visible":function(t){e.moveItemsVisible=t}}},[n("div",[e._v("您确定要移动已选中的"+e._s(e.moveItemLength)+"条问答对到“"+e._s(e.moveItemName)+"”吗？")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.moveItemsVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.moveKnowledgeItem}},[e._v("确 定")])],1)]),e._v(" "),n("el-dialog",{staticClass:"creat-faq-dialog",attrs:{title:"新增问答",visible:e.creatFAQVisible,"append-to-body":!0,width:"800px"},on:{"update:visible":function(t){e.creatFAQVisible=t}}},[n("div",[n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"手动输入",name:"first"}},[n("el-form",{ref:"creatFAQVForm",staticClass:"demo-ruleForm",attrs:{model:e.creatFAQVForm,rules:e.creatFAQVRules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"主问题",prop:"questionContent"}},[n("el-input",{attrs:{placeholder:"输入主问题"},model:{value:e.creatFAQVForm.questionContent,callback:function(t){e.$set(e.creatFAQVForm,"questionContent",t)},expression:"creatFAQVForm.questionContent"}})],1),e._v(" "),e._l(e.creatFAQVForm.questionContentOther,function(t,s){return n("el-form-item",{key:"问题"+s,attrs:{label:t.name}},[n("el-input",{attrs:{placeholder:"输入相似问题"},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"item.value"}}),e._v(" "),0==s?n("el-button",{attrs:{icon:"el-icon-plus"},on:{click:function(n){return n.preventDefault(),e.addQuestion(t)}}}):e._e(),e._v(" "),s>0?n("el-button",{attrs:{icon:"el-icon-minus"},on:{click:function(n){return n.preventDefault(),e.removeQuestion(t)}}}):e._e()],1)}),e._v(" "),n("el-row",[n("el-col",{staticClass:"row-left",attrs:{span:2}},e._l(e.creatFAQVForm.answerContent,function(t,s){return n("span",{key:s,class:{active:e.currentIndex==s},on:{click:function(n){return e.tabAnswer(t,s)}}},[e._v("\n                                        "+e._s("回答"+(s+1))+"\n                                    ")])}),0),e._v(" "),n("el-col",{staticClass:"row-center",attrs:{span:18}},[n("el-input",{attrs:{type:"textarea",placeholder:"输入回答内容"},model:{value:e.creatFAQVForm.answerContent[e.currentIndex].value,callback:function(t){e.$set(e.creatFAQVForm.answerContent[e.currentIndex],"value",t)},expression:"creatFAQVForm.answerContent[currentIndex].value"}}),e._v(" "),n("div",{staticClass:"answer-bottom"},[e._v("\n                                        您可以"),n("span",{on:{click:e.handleUseAudio}},[e._v("使用音频")]),e._v("或\n                                        "),n("span",{staticClass:"btnUpload"},[e._v("上传音频"),n("input",{staticClass:"importFile",attrs:{type:"file",multiple:"multiple"},on:{change:function(t){return e.uploadAnnexFileOfInfo()}}})]),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.creatFAQVForm.answerContent[e.currentIndex].soundPath,expression:"creatFAQVForm.answerContent[currentIndex].soundPath"}],staticClass:"play-btn"},[n("i",{staticClass:"iconfont icon-icon_play",on:{click:function(t){return e.handleVideoAnswer()}}}),e._v(" "),n("span",[e._v(e._s(e.creatFAQVForm.answerContent[e.currentIndex].fileName))]),e._v(" "),n("span",{on:{click:function(t){return e.handleCancelPlay()}}},[e._v("取消")])])])],1),e._v(" "),n("el-col",{attrs:{span:2}},[n("el-button",{attrs:{icon:"el-icon-plus"},on:{click:function(t){return t.preventDefault(),e.addAnswer()}}})],1)],1)],2)],1),e._v(" "),n("el-tab-pane",{attrs:{label:"批量上传",name:"second"}},[n("div",{staticClass:"faqUpload"},[n("el-form",{ref:"atchKnow",staticClass:"demo-ruleForm",attrs:{model:e.atchKnow,rules:e.atchKnowRules,"label-width":"100px"}},[n("div",[n("span",{staticClass:"red"},[e._v("*")]),e._v("第一步：请下载用于填写知识问答的Excel模版文件")]),e._v(" "),n("div",{staticClass:"updload-list-box"},[n("el-button",{on:{click:e.downloadExcelTemplate}},[e._v("下载模版")])],1),e._v(" "),n("div",[n("span",{staticClass:"red"},[e._v("*")]),e._v("\n                                第二步：请上传已填写完成的Excel文件（建议最多不超过1000行）\n                                "),n("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"hover",content:"填写规范：仅支持Excel文件，多个相似问题或者回答用*|*隔开，可以省略分类，问题[TAB]相似问题[TAB]回答内容<分类>"}},[n("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])],1),e._v(" "),n("div",{staticClass:"updload-list-box"},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.atchKnow.errorMessage,expression:"!atchKnow.errorMessage"}],staticClass:"file-btn"},[n("el-input",{attrs:{multiple:"multiple",type:"file",id:"file"},on:{change:function(t){return e.uploadAnnexFile("file")}},model:{value:e.atchKnow.filePath,callback:function(t){e.$set(e.atchKnow,"filePath",t)},expression:"atchKnow.filePath"}}),e._v("\n                                    上传\n                                ")],1),e._v(" "),n("span",{staticClass:"blue"},[e._v(e._s(e.atchKnow.excelPathTip))]),e._v(" "),n("span",{staticClass:"red"},[e._v(e._s(e.atchKnow.errorMessage))])],1),e._v(" "),e._l(e.correctArry,function(t,s){return n("div",{directives:[{name:"show",rawName:"v-show",value:t.nextUpload,expression:"item.nextUpload"}],key:s},[n("div",[e._v("上传失败的问答数据已生成新的Excel文件，"),n("a",{attrs:{href:t.errorFilePath}},[e._v("点击下载")]),e._v("后重新上传")]),e._v(" "),n("div",{staticClass:"updload-list-box"},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.errorMessage,expression:"!item.errorMessage"}],staticClass:"file-btn"},[n("el-input",{attrs:{multiple:"multiple",type:"file",id:t.id},on:{change:function(n){return e.uploadAnnexFile(t.id)}},model:{value:t.filePath,callback:function(n){e.$set(t,"filePath",n)},expression:"item.filePath"}}),e._v("\n                                        上传\n                                    ")],1),e._v(" "),n("span",{staticClass:"blue"},[e._v(e._s(t.excelPathTip))]),e._v(" "),n("span",{staticClass:"red"},[e._v(e._s(t.errorMessage))])],1)])})],2)],1)])],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.creatFAQVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleAddItems}},[e._v("保 存")])],1)]),e._v(" "),n("el-dialog",{attrs:{title:"音频",visible:e.videoVisible,width:"600px"},on:{"update:visible":function(t){e.videoVisible=t}}},[n("w-video",{attrs:{source:e.viewSource,playing:e.viewPlaying}})],1),e._v(" "),n("el-dialog",{staticClass:"sound-dialog",attrs:{visible:e.visibleSound,fullscreen:!0,"show-close":!1},on:{"update:visible":function(t){e.visibleSound=t}}},[n("w-sound",{attrs:{from:e.pageFrom}})],1),e._v(" "),n("el-drawer",{attrs:{title:"编辑回答",visible:e.showDrawer},on:{"update:visible":function(t){e.showDrawer=t},close:e.closeEdit}},[n("el-scrollbar",{staticClass:"drawer-form-scroll",attrs:{wrapClass:"drawer-form-scroll-warp",native:!1,noresize:!1}},[n("el-form",{ref:e.sigleKnowledgeData,attrs:{model:e.sigleKnowledgeData,rules:e.sigleKnowledgeDataRules}},[n("el-form-item",{attrs:{label:"主问题"}},[n("el-input",{model:{value:e.sigleKnowledgeData.questionContent,callback:function(t){e.$set(e.sigleKnowledgeData,"questionContent",t)},expression:"sigleKnowledgeData.questionContent"}})],1),e._v(" "),e.sigleKnowledgeData.questionContentOther?n("el-form-item",{staticClass:"similer-question",attrs:{label:"相似问题"}},[n("i",{staticClass:"iconfont icon-ico_add",staticStyle:{color:"#4E8FF9"},on:{click:e.addSimilerQuestion}}),e._v(" "),e._l(e.sigleKnowledgeData.questionContentOther,function(t,s){return n("div",{key:s,staticClass:"similer-input"},[n("el-input",{model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"item.value"}}),e._v(" "),0!==s?n("span",{staticClass:"w_icon_trash",on:{click:function(t){return e.deleteSimilerQuestion(s)}}}):e._e()],1)})],2):e._e(),e._v(" "),n("el-form-item",[n("div",[e._v("回答问题")]),e._v(" "),n("div",{staticClass:"question-content"},[n("el-tabs",{attrs:{value:e.editableTabsValue,type:"card",editable:""},on:{"tab-click":e.tabClick,edit:e.handleTabsEdit}},e._l(e.sigleKnowledgeData.editableTabs,function(t,s){return n("el-tab-pane",{key:s,attrs:{label:e._f("formatLabel")(s),name:e._f("formatName")(s)}},[n("div",{staticClass:"rep-edit-top"},[e._v("\n                                您可以"),n("span",{staticClass:"link",on:{click:function(t){return e.handleUseAudio(s)}}},[e._v("使用音频")]),e._v("（使用后将自动填充对应文本)\n                                "),n("div",{staticClass:"canel-box"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.soundPath,expression:"item.soundPath"}]},[n("i",{staticClass:"iconfont icon-icon_play",on:{click:function(n){return e.handleVideo(t)}}}),e._v(" "),n("span",[e._v(e._s(t.fileName))]),e._v(" "),n("a",{on:{click:function(n){return e.handleCancelPlay(t,s)}}},[e._v("取消")])])]),e._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.answerContent,expression:"item.answerContent"}],staticClass:"w_textarea",attrs:{disabled:!!t.soundPath},domProps:{value:t.answerContent},on:{input:function(n){n.target.composing||e.$set(t,"answerContent",n.target.value)}}})])])}),1)],1)]),e._v(" "),n("el-form-item",{staticClass:"form-item-keywords",attrs:{label:"关键词"}},[n("div",{staticClass:"keywords"},[e._l(e.sigleKnowledgeData.keyWords,function(t,s){return n("el-tag",{key:s,attrs:{closable:"","disable-transitions":!1},on:{close:function(n){return e.handleCloseKeyword(t)}}},[e._v("\n                            "+e._s(t)+"\n                        ")])}),e._v(" "),e.inputVisible?n("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):n("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+")])],2)]),e._v(" "),n("div",{staticClass:"drawer-footer"},[n("el-button",{on:{click:function(t){e.showDrawer=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.modifyKnowledgeItem}},[e._v("保 存")])],1)],1)],1)],1),e._v(" "),n("el-drawer",{staticClass:"batch-drawer",attrs:{title:"批量上传问答",visible:e.showBatchFiles},on:{"update:visible":function(t){e.showBatchFiles=t}}},[n("BatchFiles",{on:{uploadSuccess:e.uploadSuccess,closeDrawer:function(t){e.showBatchFiles=!1}}})],1),e._v(" "),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("span",[e._v(e._s(e.dialogMessage))]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)]),e._v(" "),n("AudioMatchModal",{attrs:{visible:e.soundMatchVisible,groupId:e.groupId},on:{"update:visible":function(t){e.soundMatchVisible=t},queryKnowledgeItemList:function(t){return e.queryKnowledgeItemList()}}})],1)},staticRenderFns:[]};var D=n("VU/8")(A,P,!1,function(e){n("HEAd"),n("0qUo")},"data-v-1bc7f770",null);t.default=D.exports},kMPS:function(e,t,n){"use strict";function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var r=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,d,p,m,f=e[u].replace(r,"%20"),v=f.indexOf(n);v>=0?(h=f.substr(0,v),d=f.substr(v+1)):(h=f,d=""),p=decodeURIComponent(h),m=decodeURIComponent(d),s(i,p)?a(i[p])?i[p].push(m):i[p]=[i[p],m]:i[p]=m}return i};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},qOJP:function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},runL:function(e,t){},wRsr:function(e,t){},xCWu:function(e,t,n){(function(e,s){var a;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(o){"object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType;var i="object"==typeof s&&s;i.global!==i&&i.window!==i&&i.self;var r,l=2147483647,c=36,u=1,h=26,d=38,p=700,m=72,f=128,v="-",g=/^xn--/,w=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=c-u,y=Math.floor,x=String.fromCharCode;function I(e){throw new RangeError(_[e])}function F(e,t){for(var n=e.length,s=[];n--;)s[n]=t(e[n]);return s}function k(e,t){var n=e.split("@"),s="";return n.length>1&&(s=n[0]+"@",e=n[1]),s+F((e=e.replace(b,".")).split("."),t).join(".")}function K(e){for(var t,n,s=[],a=0,o=e.length;a<o;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<o?56320==(64512&(n=e.charCodeAt(a++)))?s.push(((1023&t)<<10)+(1023&n)+65536):(s.push(t),a--):s.push(t);return s}function A(e){return F(e,function(e){var t="";return e>65535&&(t+=x((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=x(e)}).join("")}function P(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function D(e,t,n){var s=0;for(e=n?y(e/p):e>>1,e+=y(e/t);e>C*h>>1;s+=c)e=y(e/C);return y(s+(C+1)*e/(e+d))}function $(e){var t,n,s,a,o,i,r,d,p,g,w,b=[],_=e.length,C=0,x=f,F=m;for((n=e.lastIndexOf(v))<0&&(n=0),s=0;s<n;++s)e.charCodeAt(s)>=128&&I("not-basic"),b.push(e.charCodeAt(s));for(a=n>0?n+1:0;a<_;){for(o=C,i=1,r=c;a>=_&&I("invalid-input"),((d=(w=e.charCodeAt(a++))-48<10?w-22:w-65<26?w-65:w-97<26?w-97:c)>=c||d>y((l-C)/i))&&I("overflow"),C+=d*i,!(d<(p=r<=F?u:r>=F+h?h:r-F));r+=c)i>y(l/(g=c-p))&&I("overflow"),i*=g;F=D(C-o,t=b.length+1,0==o),y(C/t)>l-x&&I("overflow"),x+=y(C/t),C%=t,b.splice(C++,0,x)}return A(b)}function V(e){var t,n,s,a,o,i,r,d,p,g,w,b,_,C,F,k=[];for(b=(e=K(e)).length,t=f,n=0,o=m,i=0;i<b;++i)(w=e[i])<128&&k.push(x(w));for(s=a=k.length,a&&k.push(v);s<b;){for(r=l,i=0;i<b;++i)(w=e[i])>=t&&w<r&&(r=w);for(r-t>y((l-n)/(_=s+1))&&I("overflow"),n+=(r-t)*_,t=r,i=0;i<b;++i)if((w=e[i])<t&&++n>l&&I("overflow"),w==t){for(d=n,p=c;!(d<(g=p<=o?u:p>=o+h?h:p-o));p+=c)F=d-g,C=c-g,k.push(x(P(g+F%C,0))),d=y(F/C);k.push(x(P(d,0))),o=D(n,_,s==a),n=0,++s}++n,++t}return k.join("")}r={version:"1.4.1",ucs2:{decode:K,encode:A},decode:$,encode:V,toASCII:function(e){return k(e,function(e){return w.test(e)?"xn--"+V(e):e})},toUnicode:function(e){return k(e,function(e){return g.test(e)?$(e.slice(4).toLowerCase()):e})}},void 0===(a=function(){return r}.call(t,n,t,e))||(e.exports=a)}()}).call(t,n("3IRH")(e),n("DuR2"))},xaZU:function(e,t,n){"use strict";var s=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,r){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(i(e),function(i){var r=encodeURIComponent(s(i))+n;return a(e[i])?o(e[i],function(e){return r+encodeURIComponent(s(e))}).join(t):r+encodeURIComponent(s(e[i]))}).join(t):r?encodeURIComponent(s(r))+n+encodeURIComponent(s(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],s=0;s<e.length;s++)n.push(t(e[s],s));return n}var i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}}});