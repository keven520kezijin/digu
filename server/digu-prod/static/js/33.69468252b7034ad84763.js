webpackJsonp([33],{"A/T/":function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("fZjL"),a=t.n(o),s=t("mvHQ"),i=t.n(s),l=t("GeYD"),n=t("o3iK"),c=t("VI/i"),u=t.n(c),m={name:"basetable",data:function(){var e=this,r=function(r,t,o){null==t||""===t?o(new Error("手机号不能为空")):/^1[3456789]\d{9}$/.test(t)?$.get(e.$baseUrl+"member/checkPhoneIsExist.json?phone="+t).then(function(r){"0000"==r.resultMessageEnum?r.returnObject?o(new Error("手机号已注册！")):o():e.$message.error(r.errorInfoList[0].errorMessage)}):o(new Error("手机号格式不正确"))},t=function(r,t,o){null==t||""===t?o(new Error("组名不能为空")):$.get(e.$baseUrl+"member/checkGroupIsExist.json?groupName="+t).then(function(r){"0000"==r.resultMessageEnum?r.returnObject?o(new Error("该组已经存在！")):o():e.$message.error(r.errorInfoList[0].errorMessage)})};return{queryKey:"",filterRoleList:[],filterRoleData:[],roleList:[],cur_page:1,pagination:{show:!0,total:0,pageIndex:1,pageSize:10},accountTableData:[],height:300,options:{stripe:!0,loading:!0,highlightCurrentRow:!0,mutiSelect:!0},rules:{role:[{required:!0,message:"角色不能为空！",trigger:"change"}],groupId:[{required:!0,message:"组长不能为空！",trigger:"change"}],groupName:[{required:!0,validator:t,trigger:"change"}],phone:[{required:!0,validator:r,trigger:"blur"}],password:[{required:!0,message:"密码不能为空！",trigger:"blur"}],userName:[{required:!0,message:"真实姓名不能为空！",trigger:"change"}]},createVisible:!1,leaderList:[],functionScope:"",createForm:{role:"",groupId:"",groupName:"",phone:"",password:"",userName:"",email:""},createRoleForm:{isShow:!1,roleName:""},errors:{errorPhoneMsg:!1,errorGroupMsg:!1},removeVisible:!1,accountId:"",removeText:"",modifyVisible:!1,modifyForm:{accountId:"",roleValue:"",roleName:"",groupId:"",groupName:"",phone:"",password:"",userName:"",email:""},modifyRules:{groupName:[{required:!0,validator:t,trigger:"change"}],phone:[{required:!0,validator:r,trigger:"blur"}],password:[{required:!0,message:"密码不能为空！",trigger:"blur"}],userName:[{required:!0,message:"真实姓名不能为空！",trigger:"change"}]}}},created:function(){var e=document.documentElement.clientHeight;this.height=e-260,l.a.$emit("contentTop",!0),this.queryAccountList(),this.queryRoleList()},computed:{},methods:{handleSearch:function(){if(!this.queryKey)return this.$message.error("请输入关键字！"),!1;this.cur_page=1,this.queryAccountList()},handleSearchChange:function(e){e||this.queryAccountList()},handleCreate:function(){this.createVisible=!0,this.queryRoleList()},handleCreateAccount:function(e){var r=this;this.$refs[e].validate(function(t){if(!t)return!1;var o=u.a.createHash("md5");o.update(r.createForm.password);var a=o.digest("hex"),s={roleId:r.createForm.role.id,groupId:r.createForm.groupId,groupName:r.createForm.groupName,phone:r.createForm.phone,password:a,userName:r.createForm.userName,email:r.createForm.email};$.post(r.$baseUrl+"member/addAccount.json",i()(s)).then(function(t){"0000"==t.resultMessageEnum?(r.errors.errorPhoneMsg=!1,r.errors.errorGroupMsg=!1,r.createVisible=!1,r.$refs[e].resetFields(),r.queryAccountList(),r.$message.success("添加成功！")):"000112"==t.errorInfoList[0].errorMessageEnum?r.errors.errorPhoneMsg=!0:"080001"==t.errorInfoList[0].errorMessageEnum?r.errors.errorGroupMsg=!0:r.$message.error(t.errorInfoList[0].errorMessage)})})},handleConfirmAddRole:function(){var e=this,r={roleName:this.createRoleForm.roleName};$.post(this.$baseUrl+"member/addRole.json",i()(r)).then(function(r){"0000"==r.resultMessageEnum?(e.createRoleForm.isShow=!1,e.queryRoleList()):e.$message.error(r.errorInfoList[0].errorMessage)})},handleCheckRole:function(e,r){return n.a.taskCheckRole(e.role)},handleRemove:function(e,r){var t=this;this.removeVisible=!0,this.removeText="您确定要删除该子账号吗？",this.accountId=r.id;var o={accountId:r.id};$.post(this.$baseUrl+"member/queryTaskCheckItemNumber.json",i()(o)).then(function(e){"0000"==e.resultMessageEnum?e.returnObject>0&&(t.removeText="该账号下有正在进行中的质检任务，确定要删除该子账号吗？"):t.$message.error(e.errorInfoList[0].errorMessage)})},handleConfirmRemove:function(){var e=this,r={accountId:this.accountId};$.post(this.$baseUrl+"member/removeAccount.json",i()(r)).then(function(r){"0000"==r.resultMessageEnum?(e.$message.success("移除成功！"),e.removeVisible=!1,e.queryAccountList()):e.$message.error(r.errorInfoList[0].errorMessage)})},handleModify:function(e,r){var t=this;$.get(this.$baseUrl+"member/querytAccountById.json?id="+r.id).then(function(e){if("0000"==e.resultMessageEnum){var r=e.returnObject;t.modifyForm.accountId=r.id,t.modifyForm.roleValue=r.role,t.modifyForm.roleName=r.roleName,t.modifyForm.groupId=r.groupId,t.modifyForm.groupName=r.groupName,t.modifyForm.phone=r.phone,t.modifyForm.userName=r.userName,t.modifyForm.email=r.email,2===r.role?t.functionScope="创建任务 仅任务质检":3===r.role&&(t.functionScope="仅任务质检")}else t.$message.error(e.errorInfoList[0].errorMessage)}),this.modifyVisible=!0},handleConfirmModify:function(){var e=this,r=u.a.createHash("md5");r.update(this.modifyForm.password);var t=r.digest("hex"),o={accountId:this.modifyForm.accountId,groupId:this.modifyForm.groupId,groupName:this.modifyForm.groupName,userName:this.modifyForm.userName,email:this.modifyForm.email,password:t};$.post(this.$baseUrl+"member/modifyAccount.json",i()(o)).then(function(r){"0000"==r.resultMessageEnum?(e.$message.success("修改成功！"),e.modifyVisible=!1,e.queryAccountList()):e.$message.error(r.errorInfoList[0].errorMessage)})},handleRoleChange:function(e){e&&(2===e.roleValue?this.functionScope="创建任务 仅任务质检":3===e.roleValue&&(this.functionScope="仅任务质检",this.queryLeaderList()))},queryAccountList:function(e){var r=this,t=$.extend({},{currentPage:this.cur_page-1,pageSize:this.pagination.pageSize},e);this.queryKey&&(t.queryKey=this.queryKey),this.filterRoleList.length&&(t.roleList=this.filterRoleList),$.post(this.$baseUrl+"member/queryAccountList.json",i()(t)).then(function(e){if("0000"==e.resultMessageEnum){var t=e.returnObject.recordList;r.pagination.total=e.returnObject.totalNumber,r.accountTableData=t}else r.$message.error(e.errorInfoList[0].errorMessage)})},queryRoleList:function(){var e=this;$.get(this.$baseUrl+"member/queryRoleList.json").then(function(r){"0000"==r.resultMessageEnum?(e.roleList=[],r.returnObject&&r.returnObject.forEach(function(r,t){1!==r.roleValue&&(e.roleList.push(r),e.filterRoleData.push({text:r.roleName,value:r.roleValue}))})):e.$message.error(r.errorInfoList[0].errorMessage)})},queryLeaderList:function(){var e=this;$.get(this.$baseUrl+"member/queryLeaderList.json").then(function(r){"0000"==r.resultMessageEnum?r.returnObject&&(e.leaderList=r.returnObject):e.$message.error(r.errorInfoList[0].errorMessage)})},handleCurrentChange:function(e){this.cur_page=e,this.queryAccountList()},handleSizeChange:function(e){this.pagination.pageSize=e,this.queryAccountList()},handleFilterChange:function(e){"filterRoleList"==a()(e)[0]&&(this.filterRoleList=e.filterRoleList),this.queryAccountList()}},destroyed:function(){l.a.$emit("contentTop",!1)}},d={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"table"},[t("div",{staticClass:"content-box-top"},[t("el-input",{staticClass:"handle-input mr10",attrs:{clearable:"",placeholder:"用户名/手机号"},on:{change:e.handleSearchChange},nativeOn:{keyup:function(r){return r.type.indexOf("key")||13===r.keyCode?e.handleSearch(r):null}},model:{value:e.queryKey,callback:function(r){e.queryKey=r},expression:"queryKey"}}),e._v(" "),t("el-button",{attrs:{type:"primary",icon:"search"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v(" "),t("div",{staticClass:"content-box-top-right"},[t("el-button",{attrs:{type:"primary",icon:"iconfont icon-ico_new-task"},on:{click:e.handleCreate}},[e._v("添加账号")])],1)],1),e._v(" "),t("el-card",{staticClass:"box-card task-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("管理列表")])]),e._v(" "),t("div",[t("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.accountTableData,stripe:"",height:e.height,options:e.options,pagination:e.pagination},on:{"filter-change":e.handleFilterChange}},[t("el-table-column",{attrs:{prop:"userName",label:"用户名",width:"200"}}),e._v(" "),t("el-table-column",{attrs:{prop:"phone",label:"手机号",width:"200"}}),e._v(" "),t("el-table-column",{attrs:{prop:"role",label:"角色",width:"200","column-key":"filterRoleList",formatter:e.handleCheckRole,filters:e.filterRoleData}}),e._v(" "),t("el-table-column",{attrs:{prop:"groupName",label:"组名"}}),e._v(" "),t("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleRemove(r.$index,r.row)}}},[e._v("移除")]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleModify(r.$index,r.row)}}},[e._v("修改")])]}}])})],1),e._v(" "),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total,"page-size":e.pagination.pageSize,"page-sizes":[10,50,100,200]},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),t("el-dialog",{staticClass:"creatDialog",attrs:{title:"添加账号",visible:e.createVisible,width:"600px"},on:{"update:visible":function(r){e.createVisible=r}}},[t("el-form",{ref:"createForm",attrs:{inline:!0,rules:e.rules,model:e.createForm,"label-width":"80px"}},[t("el-form-item",{attrs:{prop:"role",label:"角色"}},[t("el-select",{staticStyle:{width:"184px"},attrs:{clearable:"","value-key":"id",placeholder:"选择角色"},on:{change:e.handleRoleChange},model:{value:e.createForm.role,callback:function(r){e.$set(e.createForm,"role",r)},expression:"createForm.role"}},[e._l(e.roleList,function(e){return t("el-option",{key:e.id,attrs:{label:e.roleName,value:e}})}),e._v(" "),t("div",{staticClass:"select_add_item"},[e.createRoleForm.isShow?t("div",{staticClass:"select-menu-input-box"},[t("el-input",{attrs:{placeholder:"输入角色名称"},model:{value:e.createRoleForm.roleName,callback:function(r){e.$set(e.createRoleForm,"roleName",r)},expression:"createRoleForm.roleName"}})],1):e._e(),e._v(" "),e.createRoleForm.isShow?t("div",{staticClass:"select-icon-box"},[t("i",{staticClass:"el-icon-check",on:{click:e.handleConfirmAddRole}}),e._v(" "),t("i",{staticClass:"el-icon-close",on:{click:function(r){e.createRoleForm.isShow=!1}}})]):e._e(),e._v(" "),t("div",[t("i",{staticClass:"el-icon-plus",on:{click:function(r){e.createRoleForm.isShow=!0}}},[t("span",[e._v("新增角色")])])])])],2)],1),e._v(" "),3===e.createForm.role.roleValue?t("el-form-item",{attrs:{prop:"groupId"}},[t("el-select",{staticStyle:{width:"184px"},attrs:{clearable:"",placeholder:"选择组长"},model:{value:e.createForm.groupId,callback:function(r){e.$set(e.createForm,"groupId",r)},expression:"createForm.groupId"}},e._l(e.leaderList,function(e){return t("el-option",{key:e.id,attrs:{label:e.leaderName+"("+e.groupName+")",value:e.groupId}})}),1)],1):e._e(),e._v(" "),2===e.createForm.role.roleValue?t("el-form-item",{attrs:{prop:"groupName",label:"组名"}},[t("el-input",{attrs:{placeholder:"输入组名"},model:{value:e.createForm.groupName,callback:function(r){e.$set(e.createForm,"groupName",r)},expression:"createForm.groupName"}})],1):e._e(),e._v(" "),t("el-form-item",{attrs:{prop:"phone",label:"手机号"}},[t("el-input",{attrs:{placeholder:"输入登录手机号"},model:{value:e.createForm.phone,callback:function(r){e.$set(e.createForm,"phone",r)},expression:"createForm.phone"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"password",label:"初始密码"}},[t("el-input",{attrs:{placeholder:"输入账号初始密码"},model:{value:e.createForm.password,callback:function(r){e.$set(e.createForm,"password",r)},expression:"createForm.password"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"userName",label:"用户名"}},[t("el-input",{attrs:{placeholder:"输入真实姓名"},model:{value:e.createForm.userName,callback:function(r){e.$set(e.createForm,"userName",r)},expression:"createForm.userName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"邮箱"}},[t("el-input",{attrs:{placeholder:"输入邮箱地址"},model:{value:e.createForm.email,callback:function(r){e.$set(e.createForm,"email",r)},expression:"createForm.email"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"功能范围"}},[t("span",[e._v(e._s(e.functionScope))])])],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(r){e.createVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.handleCreateAccount("createForm")}}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{staticClass:"creatDialog",attrs:{title:"修改账号信息",visible:e.modifyVisible,width:"600px"},on:{"update:visible":function(r){e.modifyVisible=r}}},[t("el-form",{ref:"createForm",attrs:{inline:!0,rules:e.modifyRules,model:e.modifyForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"角色"}},[t("el-select",{attrs:{clearable:"",placeholder:"选择角色",disabled:!0},model:{value:e.modifyForm.roleName,callback:function(r){e.$set(e.modifyForm,"roleName",r)},expression:"modifyForm.roleName"}})],1),e._v(" "),2===e.modifyForm.roleValue?t("el-form-item",{attrs:{prop:"groupName",label:"组名"}},[t("el-input",{attrs:{placeholder:"输入组名"},model:{value:e.modifyForm.groupName,callback:function(r){e.$set(e.modifyForm,"groupName",r)},expression:"modifyForm.groupName"}})],1):e._e(),e._v(" "),t("el-form-item",{attrs:{label:"手机号"}},[t("el-input",{attrs:{placeholder:"输入登录手机号",disabled:!0},model:{value:e.modifyForm.phone,callback:function(r){e.$set(e.modifyForm,"phone",r)},expression:"modifyForm.phone"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"password",label:"初始密码"}},[t("el-input",{attrs:{placeholder:"输入账号初始密码"},model:{value:e.modifyForm.password,callback:function(r){e.$set(e.modifyForm,"password",r)},expression:"modifyForm.password"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"userName",label:"用户名"}},[t("el-input",{attrs:{placeholder:"输入真实姓名"},model:{value:e.modifyForm.userName,callback:function(r){e.$set(e.modifyForm,"userName",r)},expression:"modifyForm.userName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"邮箱"}},[t("el-input",{attrs:{placeholder:"输入邮箱地址"},model:{value:e.modifyForm.email,callback:function(r){e.$set(e.modifyForm,"email",r)},expression:"modifyForm.email"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"功能范围"}},[t("span",[e._v(e._s(e.functionScope))])])],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(r){e.modifyVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirmModify}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"删除账号",visible:e.removeVisible,width:"400px"},on:{"update:visible":function(r){e.removeVisible=r}}},[t("div",[e._v(e._s(e.removeText))]),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(r){e.removeVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirmRemove}},[e._v("确定")])],1)])],1)},staticRenderFns:[]};var p=t("VU/8")(m,d,!1,function(e){t("w73/")},"data-v-110b9fa9",null);r.default=p.exports},"w73/":function(e,r){}});